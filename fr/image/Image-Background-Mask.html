<!DOCTYPE html>
<html lang="fr-FR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outil d'arrière-plan et de masque | CaliperTools</title>
    <meta name="description" content="Traitez les arrière-plans et les masques d'images avec 13 outils professionnels. Supprimez les arrière-plans, ajoutez des couleurs, appliquez des masques et plus encore. Aucun téléchargement requis.">
    <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon32.png">
    <link rel="stylesheet" href="../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../scripts/script.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }

        .bg-mask-container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
            height: 750px;
        }

        @media (max-width: 768px) {
            .bg-mask-container {
                flex-direction: column-reverse;
                height: auto;
            }

            .sidebar-container {
                width: 100%;
                border-right: none;
                border-top: 1px solid #ddd;
                border-bottom: none;
            }

            .sidebar {
                height: auto;
                max-height: none;
                padding: 15px;
            }

            .sidebar-content {
                max-height: none;
                overflow-y: visible;
            }

            .sidebar-actions {
                position: relative;
                border-top: 1px solid #ddd;
            }

            .canvas-area {
                height: auto;
                min-height: 400px;
                max-height: 60vh;
            }

            .upload-prompt {
                width: calc(100% - 40px);
                height: calc(100% - 40px);
            }

            .sidebar .tools-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
        }

        .sidebar-container {
            width: 380px;
            border-right: 1px solid #ddd;
        }

        .sidebar {
            padding: 20px;
            background-color: #ffffff;
            height: 750px;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        .sidebar-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            padding: 15px 20px;
            z-index: 10;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .upload-section {
            margin-bottom: 20px;
        }

        .upload-btn {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        .upload-btn:hover {
            background-color: #0056b3;
        }

        .file-input {
            display: none;
        }

        .file-upload-btn {
            padding: 8px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .file-upload-btn:hover {
            background: #2563eb;
        }

        .file-name {
            margin-left: 10px;
            color: #666;
            font-size: 14px;
            flex: 1;
        }

        .tools-section {
            margin-bottom: 20px;
        }

        .tools-section h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #0F172A;
        }

        .sidebar .tools-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .tool-btn {
            padding: 10px 5px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .tool-btn:hover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
        }

        .tool-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .tool-btn i {
            font-size: 18px;
        }

        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #0F172A;
        }

        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .setting-label {
            font-size: 14px;
            color: #666;
            min-width: 80px;
        }

        .color-picker {
            width: 50px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .help-icon {
            margin-left: 8px;
            color: #999;
            cursor: help;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .help-icon:hover {
            color: #3b82f6;
        }

        .setting-select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .setting-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .size-slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            outline: none;
            border-radius: 3px;
        }

        .size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
        }

        .size-display {
            width: 40px;
            text-align: right;
            font-size: 14px;
            color: #666;
        }

        .actions-section {
            margin-top: auto;
        }

        .action-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .clear-btn {
            background-color: #dc3545;
            color: white;
        }

        .download-btn {
            background-color: #28a745;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .canvas-area {
            flex: 1;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #ffffff;
            position: relative;
        }

        .upload-prompt {
            text-align: center;
            padding: 0;
            border: none;
            border-radius: 0;
            transition: all 0.3s ease;
            width: calc(100% - 80px);
            height: calc(100% - 80px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            border-radius: 8px;
        }

        .upload-prompt.drag-over {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
        }

        .upload-prompt-icon {
            font-size: 60px;
            color: #007bff;
            margin-bottom: 20px;
        }

        .upload-prompt-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #0F172A;
        }

        .upload-prompt-instruction {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }

        .canvas-wrapper {
            position: relative;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: transparent;
        }

        .delete-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .delete-image-btn:hover {
            background-color: rgba(220, 53, 69, 1);
            transform: scale(1.1);
        }

        .canvas-wrapper.active {
            display: block;
        }

        canvas {
            display: block;
        }

        #resultCanvas {
            position: relative;
        }

        .privacy-statement {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
            font-size: 14px;
            color: #1e40af;
        }

        /* Tutorial and Introduction Section Styles */
        .tutorial-section {
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            color: white;
            padding: 5rem 0;
            margin-top: 5rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .text-4xl {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 4rem;
        }

        .grid {
            display: grid;
            gap: 2rem;
        }

        .grid-cols-1 {
            grid-template-columns: 1fr;
        }

        @media (min-width: 640px) {
            .sm\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .lg\:grid-cols-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .tutorial-card {
            background: white;
            color: #1f2937;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .tutorial-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .tutorial-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .tutorial-icon {
            background: #3b82f6;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.25rem;
        }

        .tutorial-card p {
            color: #6b7280;
            line-height: 1.5;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            cursor: help;
            font-size: 0.875rem;
        }

        /* Feature Section Styles */
        .feature-section {
            padding: 5rem 0;
            background: white;
        }

        .feature-section.gray {
            background: #f9fafb;
        }

        .grid-cols-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 4rem;
            align-items: center;
        }

        @media (min-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .content-image img {
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        .content-text h2 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        .content-text p {
            font-size: 1.125rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            line-height: 1.75;
        }

        /* Order Classes */
        .order-2 {
            order: 2;
        }

        .order-1 {
            order: 1;
        }

        @media (min-width: 768px) {
            .md\:order-1 {
                order: 1;
            }
            .md\:order-2 {
                order: 2;
            }
        }

        /* Bottom Text Area */
        .bottom-text-section {
            padding: 5rem 0;
            background: linear-gradient(to bottom, #f9fafb, white);
        }

        .bottom-text-section h2 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        .bottom-text-section p {
            font-size: 1.125rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            line-height: 1.75;
        }

        .mb-10 {
            margin-bottom: 2.5rem;
        }

        /* Related Tools Section */
        .related-tools {
            padding: 4rem 0;
            background: white;
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 3rem;
            text-align: center;
        }

        /* Text Alignment Classes */
        .text-center {
            text-align: center;
        }
    </style>
<script>
    // 1. Disable the right-click menu.
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        alert('Le menu contextuel (menu accessible par clic droit) a été désactivé');
    });

    // 2. Disable text selection
    document.addEventListener('selectstart', function(e) {
        e.preventDefault();
    });

    // 3. Disable copy shortcut keys
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'u' || e.key === 's' || e.key === 'a')) {
            e.preventDefault();
            alert('La fonction de copie a été désactivée');
        }
    });

    // 4. Preventing the opening of developer tools via F12.
    document.addEventListener('keydown', function(e) {
        if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
            e.preventDefault();
            alert('Les outils de développement ont été désactivés');
        }
    });
</script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col font-sans">
    <main class="main">
        <div style="padding: 2rem 0;">
            <h1 class="text-3xl font-bold text-center mb-8">Outil d'arrière-plan et de masque</h1>
        </div>
        <div class="bg-mask-container">
                    <div class="sidebar-container">
                        <div class="sidebar">
                            <div class="sidebar-content">
                                <div class="upload-section">
                                    <button id="upload-btn" class="upload-btn">
                                        <i class="fas fa-upload"></i> Télécharger une image
                                    </button>
                                    <input type="file" id="file-input" class="file-input" accept="image/jpeg,image/png,image/webp">
                                </div>

                                <div class="tools-section">
                                    <h2>Outils d'arrière-plan<span class="help-icon" title="Remarque : Les outils Ajouter un arrière-plan solide/dégradé/motif ne fonctionnent qu'avec des images ayant un fond transparent. Les couleurs d'arrière-plan ne seront visibles que dans les zones transparentes de l'image.">
                                        <i class="fas fa-question-circle"></i>
                                    </span></h2>
                                    <div class="tools-grid">
                                        <button class="tool-btn" data-mode="remove-bg" data-title="Supprimer l'arrière-plan de l'image en ligne" data-description="Supprimez instantanément l'arrière-plan de couleur unie des images en ligne. Rendez les images transparentes avec une tolérance réglable. Parfait pour les photos de produits, les logos et les graphismes. Téléchargez au format PNG avec un arrière-plan transparent.">
                                            <i class="fas fa-eraser"></i>
                                            <span>Suppr. fond</span>
                                        </button>
                                        <button class="tool-btn" data-mode="add-solid-bg" data-title="Ajouter une couleur d'arrière-plan à l'image" data-description="Ajoutez un arrière-plan de couleur unie aux images transparentes en ligne. Remplissez les zones transparentes avec n'importe quelle couleur. Fonctionne mieux avec les images PNG avec transparence. Exportez au format PNG.">
                                            <i class="fas fa-fill-drip"></i>
                                            <span>Fond uni</span>
                                        </button>
                                        <button class="tool-btn" data-mode="add-gradient-bg" data-title="Ajouter un arrière-plan dégradé à l'image" data-description="Ajoutez un arrière-plan dégradé aux images transparentes en ligne. Créez de belles transitions de couleur avec des dégradés horizontaux, verticaux ou diagonaux. Parfait pour les réseaux sociaux et les projets de conception.">
                                            <i class="fas fa-palette"></i>
                                            <span>Dégradé</span>
                                        </button>
                                        <button class="tool-btn" data-mode="add-pattern-bg" data-title="Ajouter un motif d'arrière-plan à l'image" data-description="Ajoutez un motif d'arrière-plan aux images transparentes en ligne. Choisissez entre des motifs de points, de lignes, de grille ou de damier. Personnalisez les couleurs pour correspondre à votre conception. Exportez au format PNG.">
                                            <i class="fas fa-th"></i>
                                            <span>Motif</span>
                                        </button>
                                        <button class="tool-btn" data-mode="resize-bg-fit" data-title="Redimensionner l'image en ligne" data-description="Redimensionnez l'image et adaptez-la avec une couleur d'arrière-plan. Parfait pour créer des vignettes, des publications sur les réseaux sociaux et des images de produits. Définissez des dimensions personnalisées et une couleur d'arrière-plan.">
                                            <i class="fas fa-expand-arrows-alt"></i>
                                            <span>Redim.</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="tools-section">
                                    <h2>Outils de rognage / masque</h2>
                                    <div class="tools-grid">
                                        <button class="tool-btn" data-mode="crop-foreground" data-title="Rogner l'image en ligne" data-description="Rognez l'image à l'objet au premier plan en ligne. Supprimez automatiquement l'espace vide et rognez jusqu'au sujet principal. Parfait pour la photographie de produits et les portraits. Téléchargez au format PNG.">
                                            <i class="fas fa-crop"></i>
                                            <span>Rogn. PF</span>
                                        </button>
                                        <button class="tool-btn" data-mode="auto-crop" data-title="Rogner automatiquement l'image" data-description="Rognez automatiquement les bords transparents en ligne. Supprimez les zones transparentes vides des images. Parfait pour nettoyer les images PNG avec une transparence excessive. Exportez au format PNG.">
                                            <i class="fas fa-crop-alt"></i>
                                            <span>Rogn. auto</span>
                                        </button>
                                        <button class="tool-btn" data-mode="center-crop" data-title="Centrer le rognage de l'image en ligne" data-description="Centre l'objet dans la zone de rognage en ligne. Détecte et centre automatiquement le sujet principal. Parfait pour créer des vignettes et des photos de profil. Définissez des dimensions personnalisées.">
                                            <i class="fas fa-compress-arrows-alt"></i>
                                            <span>Centrer</span>
                                        </button>
                                        <button class="tool-btn" data-mode="mask-circle" data-title="Masque circulaire pour image en ligne" data-description="Appliquez un masque circulaire à l'image en ligne. Créez des photos et des avatars circulaires parfaits. Ajustez la taille et la position. Parfait pour les photos de profil et les réseaux sociaux. Exportez au format PNG.">
                                            <i class="fas fa-circle"></i>
                                            <span>Cercle</span>
                                        </button>
                                        <button class="tool-btn" data-mode="mask-square" data-title="Masque carré pour image en ligne" data-description="Appliquez un masque carré à l'image en ligne. Créez des photos carrées avec des coins arrondis. Ajustez la taille, la position et le rayon des coins. Parfait pour Instagram et les réseaux sociaux. Exportez au format PNG.">
                                            <i class="fas fa-square"></i>
                                            <span>Carré</span>
                                        </button>
                                        <button class="tool-btn" data-mode="mask-custom" data-title="Masque personnalisé pour image en ligne" data-description="Appliquez un masque personnalisé à l'image en ligne. Téléchargez votre propre image de masque pour créer des formes et des effets uniques. Parfait pour les projets créatifs et les conceptions personnalisées. Exportez au format PNG.">
                                            <i class="fas fa-draw-polygon"></i>
                                            <span>Personnalisé</span>
                                        </button>
                                        <button class="tool-btn" data-mode="apply-alpha-mask" data-title="Appliquer un masque alpha à l'image en ligne" data-description="Appliquez un masque alpha provenant d'une autre image en ligne. Utilisez une image en niveaux de gris pour contrôler la transparence. Parfait pour la composition d'images avancée et les effets créatifs. Exportez au format PNG.">
                                            <i class="fas fa-mask"></i>
                                            <span>Alpha</span>
                                        </button>
                                        <button class="tool-btn" data-mode="remove-alpha-mask" data-title="Supprimer le masque alpha de l'image en ligne" data-description="Supprimez la transparence et ajoutez une couleur d'arrière-plan en ligne. Aplatissez les images transparentes avec un arrière-plan solide. Parfait pour convertir PNG en JPG. Choisissez n'importe quelle couleur d'arrière-plan.">
                                            <i class="fas fa-layer-group"></i>
                                            <span>Suppr. alpha</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="settings-section" id="settings-section">
                                    <h2>Paramètres de l'outil</h2>
                                    <div id="dynamic-settings">
                                        <p style="color: #666; font-size: 14px;">Sélectionnez un outil pour voir les paramètres</p>
                                    </div>
                                </div>

                                <div class="privacy-statement">
                                    <i class="fas fa-shield-alt" style="margin-right: 8px;"></i>
                                    Les fichiers sont traités localement et supprimés automatiquement après le traitement.
                                </div>
                            </div>

                            <div class="sidebar-actions">
                                <div class="action-row">
                                    <button id="clear-btn" class="action-btn clear-btn">
                                        <i class="fas fa-trash"></i> Tout effacer
                                    </button>
                                    <button id="download-btn" class="action-btn download-btn" disabled>
                                        <i class="fas fa-download"></i> Exporter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="canvas-area">
                        <div id="upload-prompt" class="upload-prompt">
                            <div class="upload-prompt-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="upload-prompt-title">Outil d'arrière-plan et de masque</div>
                            <div class="upload-prompt-instruction">Cliquez ici ou glissez-déposez une image pour commencer le traitement</div>
                            <p style="font-size: 14px; color: #666; margin-top: 10px;">Prend en charge : JPG, PNG, WebP</p>
                        </div>

                        <div id="canvas-wrapper" class="canvas-wrapper">
                            <button id="delete-image-btn" class="delete-image-btn" title="Supprimer l'image">
                                <i class="fas fa-times"></i>
                            </button>
                            <canvas id="resultCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Tutorial Section -->
    <section class="tutorial-section">
        <div class="container">
            <h2 class="text-4xl">Comment utiliser l'outil d'arrière-plan et de masque</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Step 1 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </span>
                        Télécharger une image
                    </h3>
                    <p title="Glissez-déposez votre image directement sur la zone de téléchargement ou cliquez sur le bouton de téléchargement pour en choisir une depuis votre appareil. Prend en charge les formats JPG, PNG et WebP.">Glissez-déposez votre image directement sur la zone de téléchargement ou cliquez sur le bouton de téléchargement pour en choisir une depuis votre appareil. Prend en charge les formats JPG, PNG et WebP.</p>
                </div>
                <!-- Step 2 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-magic"></i>
                        </span>
                        Sélectionner un outil
                    </h3>
                    <p title="Choisissez parmi 13 outils d'arrière-plan et de masque, notamment Supprimer l'arrière-plan, Ajouter un arrière-plan solide/dégradé/motif, Rogner, Rogner automatiquement, Centrer le rognage, Masque circulaire/carré/personnalisé, Appliquer/Supprimer le masque alpha et Redimensionner + Adapter l'arrière-plan.">Choisissez parmi 13 outils d'arrière-plan et de masque, notamment Supprimer l'arrière-plan, Ajouter un arrière-plan solide/dégradé/motif, Rogner, Rogner automatiquement, Centrer le rognage, Masque circulaire/carré/personnalisé, Appliquer/Supprimer le masque alpha et Redimensionner + Adapter l'arrière-plan.</p>
                </div>
                <!-- Step 3 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-sliders-h"></i>
                        </span>
                        Ajuster les paramètres
                    </h3>
                    <p title="Personnalisez les paramètres de l'outil, notamment le sélecteur de couleur, le niveau de tolérance, la direction du dégradé, la taille du masque et plus encore selon l'outil sélectionné.">Personnalisez les paramètres de l'outil, notamment le sélecteur de couleur, le niveau de tolérance, la direction du dégradé, la taille du masque et plus encore selon l'outil sélectionné.</p>
                </div>
                <!-- Step 4 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-download"></i>
                        </span>
                        Exporter l'image
                    </h3>
                    <p title="Cliquez sur le bouton Exporter pour télécharger votre image traitée au format PNG. Toutes les opérations d'arrière-plan et de masque sont appliquées à votre image.">Cliquez sur le bouton Exporter pour télécharger votre image traitée au format PNG. Toutes les opérations d'arrière-plan et de masque sont appliquées à votre image.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Feature Introduction Section -->
    <section class="feature-section">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-image">
                    <img src="https://images.unsplash.com/photo-1476820865390-c52aeebb9891?w=600&h=400&fit=crop" alt="Background & Mask Tool" class="rounded-xl shadow-2xl w-full">
                </div>
                <div class="content-text">
                    <h2>Traitement professionnel d'arrière-plan et de masque</h2>
                    <p>Traitez les arrière-plans et les masques d'images avec précision et facilité. Notre outil fournit 13 outils d'arrière-plan et de masque professionnels pour vous aider à supprimer les arrière-plans, ajouter des couleurs, appliquer des masques et plus encore.</p>
                    <p>Parfait pour le commerce électronique, les réseaux sociaux, la photographie et toute image nécessitant un traitement d'arrière-plan ou de masque.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Tool Features Section -->
    <section class="feature-section gray">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-text order-2 md:order-1">
                    <h2>Outils d'arrière-plan puissants</h2>
                    <p>Du simple retrait d'arrière-plan aux arrière-plans avancés en dégradé et en motif, notre outil a tout ce dont vous avez besoin pour traiter professionnellement les arrière-plans d'images.</p>
                    <p>Supprimez les arrière-plans solides, ajoutez des arrière-plans transparents ou colorés, appliquez divers masques et rognez les images pour vous concentrer sur votre sujet.</p>
                </div>
                <div class="content-image order-1 md:order-2">
                    <img src="https://plus.unsplash.com/premium_photo-1674984909531-7b3ac0035e60?w=600&h=400&fit=crop" alt="Background Tools" class="rounded-xl shadow-2xl w-full">
                </div>
            </div>
        </div>
    </section>
    
    <!-- Privacy & Security Section -->
    <section class="feature-section">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-image">
                    <img src="https://images.unsplash.com/photo-1553984840-b8cbc34f5215?w=600&h=400&fit=crop" alt="Privacy Protection" class="rounded-xl shadow-2xl w-full">
                </div>
                <div class="content-text">
                    <h2>Protection de la vie privée à 100%</h2>
                    <p>Tout le traitement des images se fait localement dans votre navigateur. Vos images ne sont jamais téléchargées sur aucun serveur.</p>
                    <p>Vos données restent sur votre appareil, assurant une confidentialité et une sécurité totales pour les images sensibles.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Mobile Support Section -->
    <section class="feature-section gray">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-text order-2 md:order-1">
                    <h2>Conception conviviale pour mobile</h2>
                    <p>Traitez les arrière-plans et les masques en déplacement avec notre conception adaptée aux mobiles. Notre outil fonctionne parfaitement sur les smartphones et les tablettes.</p>
                    <p>Avec une interface réactive qui s'adapte à toutes les tailles d'écran, vous pouvez facilement télécharger, traiter et télécharger des images à l'aide de votre appareil mobile.</p>
                </div>
                <div class="content-image order-1 md:order-2">
                    <img src="https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=600&h=400&fit=crop" alt="Mobile-Friendly Design" class="rounded-xl shadow-2xl w-full">
                </div>
            </div>
        </div>
    </section>

    <!-- Bottom Text Area -->
    <section class="bottom-text-section">
        <div class="container">
            <h2>Traitement facile et gratuit d'arrière-plans et de masques</h2>
            <p>Dites adieu à l'utilisation de logiciels complexes pour traiter les arrière-plans et les masques d'images. Avec CaliperTools Arrière-plan et Masque, vous pouvez ajouter sans effort des arrière-plans et des masques professionnels à vos images gratuitement. Le mieux est que vous pouvez utiliser notre outil depuis n'importe quel appareil disposant d'un navigateur, aucun téléchargement ni installation requis. Aucune expérience nécessaire !</p>
            <p class="mb-10">Utilisez l'éditeur par glisser-déposer pour télécharger vos images, et CaliperTools Arrière-plan et Masque s'occupera du reste. Une fois terminé, téléchargez vos images traitées au format PNG. Traitez autant d'images que vous le souhaitez, le tout en quelques clics seulement.</p>
            
            <h2>Un traitement de haute qualité à chaque fois</h2>
            <p>Préservez la qualité de vos images tout en ajoutant des arrière-plans et des masques professionnels. Nos outils avancés garantissent que vos images conservent leur clarté et leurs détails, que vous supprimiez les arrière-plans, ajoutiez des couleurs ou appliquiez des masques.</p>
            <p>Avec nos options de personnalisation intégrées, vous pouvez ajuster les couleurs, les tolérances et les tailles, et choisir parmi 13 outils d'arrière-plan et de masque différents pour faire ressortir vos images. Élevez vos photos et améliorez votre communication avec des images parfaitement traitées.</p>
        </div>
    </section>

    <!-- Related Tools Section -->
    <section class="section related-tools py-16 bg-white">
        <div class="container mx-auto px-6 max-w-[1400px]">
            <h2 class="section-title text-3xl font-bold text-gray-900 mb-12 text-center">Outils associés</h2>
            <div class="tools-grid" id="relatedTools">
            </div>
        </div>
    </section>

    </main>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- Related Tools Script -->
    <script src="../scripts/script-related-tools.js"></script>
    <script>
        // Initialize related tools
        document.addEventListener('DOMContentLoaded', function() {
            const currentSlug = 'image-background-mask-tool';
            if (typeof initRelatedTools === 'function') {
                initRelatedTools(currentSlug);
            }
        });
    </script>

    <script>
        let resultCanvas, resultCtx;
        let originalImage = null;
        let currentMode = null;
        let currentSettings = {};
        let displayWidth = 0;
        let displayHeight = 0;

        const uploadBtn = document.getElementById('upload-btn');
        const fileInput = document.getElementById('file-input');
        const uploadPrompt = document.getElementById('upload-prompt');
        const canvasWrapper = document.getElementById('canvas-wrapper');
        const deleteImageBtn = document.getElementById('delete-image-btn');
        const clearBtn = document.getElementById('clear-btn');
        const downloadBtn = document.getElementById('download-btn');
        const toolButtons = document.querySelectorAll('.tool-btn');
        const dynamicSettings = document.getElementById('dynamic-settings');

        const settingsTemplates = {
            'remove-bg': `
                <div class="setting-row">
                    <span class="setting-label">Couleur cible :</span>
                    <input type="color" id="setting-target-color" class="color-picker" value="#ffffff">
                </div>
                <div class="setting-row">
                    <span class="setting-label">Tolérance :</span>
                    <input type="range" id="setting-tolerance" class="size-slider" min="0" max="100" value="20">
                    <span id="tolerance-display" class="size-display">20%</span>
                </div>
            `,
            'add-solid-bg': `
                <div class="setting-row">
                    <span class="setting-label">Background:</span>
                    <input type="color" id="setting-bg-color" class="color-picker" value="#ffffff">
                    <span class="help-icon" title="This tool only works with transparent background images. The background color will only be visible in transparent areas of the image.">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </div>
            `,
            'add-gradient-bg': `
                <div class="setting-row">
                    <span class="setting-label">Couleur de départ :</span>
                    <input type="color" id="setting-gradient-start" class="color-picker" value="#ffffff">
                </div>
                <div class="setting-row">
                    <span class="setting-label">Couleur finale :</span>
                    <input type="color" id="setting-gradient-end" class="color-picker" value="#000000">
                    <span class="help-icon" title="This tool only works with transparent background images. The gradient background will only be visible in transparent areas of image.">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Direction :</span>
                    <select id="setting-gradient-direction" class="setting-select">
                        <option value="horizontal">Horizontal</option>
                        <option value="vertical">Verticale</option>
                        <option value="diagonal">Diagonale</option>
                    </select>
                </div>
            `,
            'add-pattern-bg': `
                <div class="setting-row">
                    <span class="setting-label">Motif :</span>
                    <select id="setting-pattern" class="setting-select">
                        <option value="dots">Points</option>
                        <option value="lines">Lignes</option>
                        <option value="grid">Grille</option>
                        <option value="checkerboard">Damier</option>
                    </select>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Couleur 1 :</span>
                    <input type="color" id="setting-pattern-color1" class="color-picker" value="#ffffff">
                </div>
                <div class="setting-row">
                    <span class="setting-label">Couleur 2 :</span>
                    <input type="color" id="setting-pattern-color2" class="color-picker" value="#000000">
                </div>
            `,
            'resize-bg-fit': `
                <div class="setting-row">
                    <span class="setting-label">Largeur :</span>
                    <input type="number" id="setting-width" class="setting-input" value="800" min="100" max="4000">
                </div>
                <div class="setting-row">
                    <span class="setting-label">Hauteur :</span>
                    <input type="number" id="setting-height" class="setting-input" value="600" min="100" max="4000">
                </div>
                <div class="setting-row">
                    <span class="setting-label">Arrière-plan :</span>
                    <input type="color" id="setting-bg-color" class="color-picker" value="#ffffff">
                </div>
            `,
            'crop-foreground': `
                <p style="color: #666; font-size: 14px;">Cet outil rognonnera l'image à l'objet au premier plan.</p>
            `,
            'auto-crop': `
                <p style="color: #666; font-size: 14px;">Cet outil rogne automatiquement les bords transparents.</p>
            `,
            'center-crop': `
                <div class="setting-row">
                    <span class="setting-label">Largeur :</span>
                    <input type="number" id="setting-width" class="setting-input" value="800" min="100" max="4000">
                </div>
                <div class="setting-row">
                    <span class="setting-label">Hauteur :</span>
                    <input type="number" id="setting-height" class="setting-input" value="600" min="100" max="4000">
                </div>
            `,
            'mask-circle': `
                <div class="setting-row">
                    <span class="setting-label">Taille :</span>
                    <input type="range" id="setting-mask-size" class="size-slider" min="50" max="500" value="200">
                    <span id="mask-size-display" class="size-display">200px</span>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Position :</span>
                    <select id="setting-mask-position" class="setting-select">
                        <option value="center">Centre</option>
                        <option value="top-left">En haut à gauche</option>
                        <option value="top-right">En haut à droite</option>
                        <option value="bottom-left">En bas à gauche</option>
                        <option value="bottom-right">En bas à droite</option>
                    </select>
                </div>
            `,
            'mask-square': `
                <div class="setting-row">
                    <span class="setting-label">Taille :</span>
                    <input type="range" id="setting-mask-size" class="size-slider" min="50" max="500" value="200">
                    <span id="mask-size-display" class="size-display">200px</span>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Position :</span>
                    <select id="setting-mask-position" class="setting-select">
                        <option value="center">Centre</option>
                        <option value="top-left">En haut à gauche</option>
                        <option value="top-right">En haut à droite</option>
                        <option value="bottom-left">En bas à gauche</option>
                        <option value="bottom-right">En bas à droite</option>
                    </select>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Rayon des coins :</span>
                    <input type="range" id="setting-corner-radius" class="size-slider" min="0" max="100" value="0">
                    <span id="corner-radius-display" class="size-display">0px</span>
                </div>
            `,
            'mask-custom': `
                <p style="color: #666; font-size: 14px;">Télécharger une image de masque personnalisée à appliquer.</p>
                <div class="setting-row">
                    <span class="setting-label">Image de masque :</span>
                    <input type="file" id="mask-custom-file" class="file-input" accept="image/png,image/jpeg">
                    <button class="file-upload-btn" onclick="document.getElementById('mask-custom-file').click()">
                        <i class="fas fa-upload"></i> Choisir un fichier
                    </button>
                    <span id="mask-custom-file-name" class="file-name">Aucun fichier choisi</span>
                </div>
            `,
            'apply-alpha-mask': `
                <p style="color: #666; font-size: 14px;">Télécharger une image de masque à utiliser comme canal alpha.</p>
                <div class="setting-row">
                    <span class="setting-label">Image de masque :</span>
                    <input type="file" id="alpha-mask-file" class="file-input" accept="image/png,image/jpeg">
                    <button class="file-upload-btn" onclick="document.getElementById('alpha-mask-file').click()">
                        <i class="fas fa-upload"></i> Choisir un fichier
                    </button>
                    <span id="alpha-mask-file-name" class="file-name">Aucun fichier choisi</span>
                </div>
            `,
            'remove-alpha-mask': `
                <div class="setting-row">
                    <span class="setting-label">Arrière-plan :</span>
                    <input type="color" id="setting-bg-color" class="color-picker" value="#ffffff">
                </div>
            `
        };

        function getSettingValue(id) {
            const element = document.getElementById(id);
            console.log('getSettingValue - ID:', id, 'Element:', element, 'Value:', element ? element.value : 'null');
            return element ? element.value : null;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function updateSettingsPanel(mode) {
            if (settingsTemplates[mode]) {
                dynamicSettings.innerHTML = settingsTemplates[mode];
                console.log('Settings panel updated for mode:', mode);
                
                if (mode === 'add-solid-bg') {
                    canvasWrapper.style.backgroundColor = '#ffffff';
                } else {
                    canvasWrapper.style.backgroundColor = 'transparent';
                }
                
                setTimeout(function() {
                    processImages();
                }, 100);
            } else {
                dynamicSettings.innerHTML = '<p style="color: #666; font-size: 14px;">Aucun paramètre pour ce mode</p>';
            }
        }

        function processImages() {
            if (!currentMode) return;
            
            if (!originalImage) {
                console.log('No image loaded yet');
                return;
            }

            console.log('Processing mode:', currentMode);
            console.log('Display dimensions:', displayWidth, 'x', displayHeight);
            console.log('Canvas dimensions:', resultCanvas.width, 'x', resultCanvas.height);
            
            resultCanvas.width = displayWidth;
            resultCanvas.height = displayHeight;

            console.log('Switching to case:', currentMode);
            switch (currentMode) {
                case 'remove-bg':
                    console.log('Calling processRemoveBackground');
                    processRemoveBackground();
                    break;
                case 'add-solid-bg':
                    console.log('Calling processAddSolidBackground');
                    processAddSolidBackground();
                    break;
                case 'add-gradient-bg':
                    processAddGradientBackground();
                    break;
                case 'add-pattern-bg':
                    processAddPatternBackground();
                    break;
                case 'resize-bg-fit':
                    processResizeBackgroundFit();
                    break;
                case 'crop-foreground':
                    processCropForeground();
                    break;
                case 'auto-crop':
                    processAutoCrop();
                    break;
                case 'center-crop':
                    processCenterCrop();
                    break;
                case 'mask-circle':
                    processMaskCircle();
                    break;
                case 'mask-square':
                    processMaskSquare();
                    break;
                case 'mask-custom':
                    processMaskCustom();
                    break;
                case 'apply-alpha-mask':
                    processApplyAlphaMask();
                    break;
                case 'remove-alpha-mask':
                    processRemoveAlphaMask();
                    break;
            }

            downloadBtn.disabled = false;
        }

        function processRemoveBackground() {
            console.log('Processing Remove Background');
            const targetColor = hexToRgb(getSettingValue('setting-target-color'));
            const tolerance = parseInt(getSettingValue('setting-tolerance')) || 20;
            console.log('Target color:', targetColor, 'Tolerance:', tolerance);
            console.log('Canvas size:', resultCanvas.width, 'x', resultCanvas.height);

            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            const imageData = resultCtx.getImageData(0, 0, resultCanvas.width, resultCanvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                const dr = Math.abs(r - targetColor.r);
                const dg = Math.abs(g - targetColor.g);
                const db = Math.abs(b - targetColor.b);

                if (dr + dg + db < tolerance * 3) {
                    data[i + 3] = 0;
                }
            }

            resultCtx.putImageData(imageData, 0, 0);
            console.log('Remove Background completed');
        }

        function processAddSolidBackground() {
            const bgColor = getSettingValue('setting-bg-color') || '#ffffff';
            console.log('Add Solid Background - Background color:', bgColor);
            console.log('Canvas size:', resultCanvas.width, 'x', resultCanvas.height);
            console.log('Display size:', displayWidth, 'x', displayHeight);
            console.log('Original image size:', originalImage.width, 'x', originalImage.height);
            
            resultCtx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
            resultCtx.fillStyle = bgColor;
            resultCtx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);
            
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            
            console.log('Canvas data URL:', resultCanvas.toDataURL('image/png').substring(0, 100));
            console.log('Add Solid Background completed');
        }

        function processAddGradientBackground() {
            const startColor = getSettingValue('setting-gradient-start') || '#ffffff';
            const endColor = getSettingValue('setting-gradient-end') || '#000000';
            const direction = getSettingValue('setting-gradient-direction') || 'horizontal';
            
            console.log('Add Gradient Background - Start color:', startColor, 'End color:', endColor, 'Direction:', direction);

            let gradient;
            if (direction === 'horizontal') {
                gradient = resultCtx.createLinearGradient(0, 0, resultCanvas.width, 0);
            } else if (direction === 'vertical') {
                gradient = resultCtx.createLinearGradient(0, 0, 0, resultCanvas.height);
            } else {
                gradient = resultCtx.createLinearGradient(0, 0, resultCanvas.width, resultCanvas.height);
            }

            gradient.addColorStop(0, startColor);
            gradient.addColorStop(1, endColor);

            resultCtx.fillStyle = gradient;
            resultCtx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            
            console.log('Add Gradient Background completed');
        }

        function processAddPatternBackground() {
            const pattern = getSettingValue('setting-pattern') || 'dots';
            const color1 = getSettingValue('setting-pattern-color1') || '#ffffff';
            const color2 = getSettingValue('setting-pattern-color2') || '#000000';

            resultCtx.fillStyle = color1;
            resultCtx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);

            const patternCanvas = document.createElement('canvas');
            patternCanvas.width = 20;
            patternCanvas.height = 20;
            const patternCtx = patternCanvas.getContext('2d');

            if (pattern === 'dots') {
                patternCtx.fillStyle = color2;
                patternCtx.beginPath();
                patternCtx.arc(10, 10, 3, 0, Math.PI * 2);
                patternCtx.fill();
            } else if (pattern === 'lines') {
                patternCtx.strokeStyle = color2;
                patternCtx.lineWidth = 2;
                patternCtx.beginPath();
                patternCtx.moveTo(0, 10);
                patternCtx.lineTo(20, 10);
                patternCtx.stroke();
            } else if (pattern === 'grid') {
                patternCtx.strokeStyle = color2;
                patternCtx.lineWidth = 1;
                patternCtx.strokeRect(0, 0, 20, 20);
            } else if (pattern === 'checkerboard') {
                patternCtx.fillStyle = color2;
                patternCtx.fillRect(0, 0, 10, 10);
                patternCtx.fillRect(10, 10, 10, 10);
            }

            const createdPattern = resultCtx.createPattern(patternCanvas, 'repeat');
            resultCtx.fillStyle = createdPattern;
            resultCtx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
        }

        function processResizeBackgroundFit() {
            const targetWidth = parseInt(getSettingValue('setting-width')) || 800;
            const targetHeight = parseInt(getSettingValue('setting-height')) || 600;
            const bgColor = getSettingValue('setting-bg-color') || '#ffffff';

            resultCanvas.width = targetWidth;
            resultCanvas.height = targetHeight;

            resultCtx.fillStyle = bgColor;
            resultCtx.fillRect(0, 0, targetWidth, targetHeight);

            const scale = Math.min(targetWidth / originalImage.width, targetHeight / originalImage.height);
            const newWidth = originalImage.width * scale;
            const newHeight = originalImage.height * scale;
            const x = (targetWidth - newWidth) / 2;
            const y = (targetHeight - newHeight) / 2;

            resultCtx.drawImage(originalImage, x, y, newWidth, newHeight);
        }

        function processCropForeground() {
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            const imageData = resultCtx.getImageData(0, 0, resultCanvas.width, resultCanvas.height);
            const data = imageData.data;

            let minX = resultCanvas.width, minY = resultCanvas.height;
            let maxX = 0, maxY = 0;
            let hasContent = false;

            for (let y = 0; y < resultCanvas.height; y++) {
                for (let x = 0; x < resultCanvas.width; x++) {
                    const i = (y * resultCanvas.width + x) * 4;
                    if (data[i + 3] > 0) {
                        hasContent = true;
                        minX = Math.min(minX, x);
                        minY = Math.min(minY, y);
                        maxX = Math.max(maxX, x);
                        maxY = Math.max(maxY, y);
                    }
                }
            }

            if (hasContent) {
                const croppedWidth = maxX - minX + 1;
                const croppedHeight = maxY - minY + 1;

                const croppedData = resultCtx.getImageData(minX, minY, croppedWidth, croppedHeight);
                resultCanvas.width = croppedWidth;
                resultCanvas.height = croppedHeight;
                resultCtx.putImageData(croppedData, 0, 0);
            }
        }

        function processAutoCrop() {
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            const imageData = resultCtx.getImageData(0, 0, resultCanvas.width, resultCanvas.height);
            const data = imageData.data;

            let minX = resultCanvas.width, minY = resultCanvas.height;
            let maxX = 0, maxY = 0;
            let hasContent = false;

            for (let y = 0; y < resultCanvas.height; y++) {
                for (let x = 0; x < resultCanvas.width; x++) {
                    const i = (y * resultCanvas.width + x) * 4;
                    if (data[i + 3] > 0) {
                        hasContent = true;
                        minX = Math.min(minX, x);
                        minY = Math.min(minY, y);
                        maxX = Math.max(maxX, x);
                        maxY = Math.max(maxY, y);
                    }
                }
            }

            if (hasContent) {
                const croppedWidth = maxX - minX + 1;
                const croppedHeight = maxY - minY + 1;

                const croppedData = resultCtx.getImageData(minX, minY, croppedWidth, croppedHeight);
                resultCanvas.width = croppedWidth;
                resultCanvas.height = croppedHeight;
                resultCtx.putImageData(croppedData, 0, 0);
            }
        }

        function processCenterCrop() {
            const targetWidth = parseInt(getSettingValue('setting-width')) || 800;
            const targetHeight = parseInt(getSettingValue('setting-height')) || 600;
            
            console.log('Center Crop - Target size:', targetWidth, 'x', targetHeight);
            console.log('Center Crop - Display size:', displayWidth, 'x', displayHeight);
            console.log('Center Crop - Original size:', originalImage.width, 'x', originalImage.height);

            resultCanvas.width = displayWidth;
            resultCanvas.height = displayHeight;
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);

            const imageData = resultCtx.getImageData(0, 0, resultCanvas.width, resultCanvas.height);
            const data = imageData.data;

            let minX = resultCanvas.width, minY = resultCanvas.height;
            let maxX = 0, maxY = 0;
            let hasContent = false;

            for (let y = 0; y < resultCanvas.height; y++) {
                for (let x = 0; x < resultCanvas.width; x++) {
                    const i = (y * resultCanvas.width + x) * 4;
                    if (data[i + 3] > 0) {
                        hasContent = true;
                        minX = Math.min(minX, x);
                        minY = Math.min(minY, y);
                        maxX = Math.max(maxX, x);
                        maxY = Math.max(maxY, y);
                    }
                }
            }

            console.log('Center Crop - Bounding box:', minX, minY, maxX, maxY, 'Has content:', hasContent);

            if (hasContent) {
                const objectWidth = maxX - minX + 1;
                const objectHeight = maxY - minY + 1;

                resultCanvas.width = targetWidth;
                resultCanvas.height = targetHeight;

                const scale = Math.min(targetWidth / objectWidth, targetHeight / objectHeight);
                const scaledObjectWidth = objectWidth * scale;
                const scaledObjectHeight = objectHeight * scale;

                const x = (targetWidth - scaledObjectWidth) / 2;
                const y = (targetHeight - scaledObjectHeight) / 2;

                const scaleX = originalImage.width / displayWidth;
                const scaleY = originalImage.height / displayHeight;

                console.log('Center Crop - Object size:', objectWidth, 'x', objectHeight);
                console.log('Center Crop - Scale:', scale);
                console.log('Center Crop - Scaled object size:', scaledObjectWidth, 'x', scaledObjectHeight);
                console.log('Center Crop - Position:', x, y);

                resultCtx.drawImage(originalImage, 
                    minX * scaleX, 
                    minY * scaleY, 
                    objectWidth * scaleX, 
                    objectHeight * scaleY,
                    x, y, scaledObjectWidth, scaledObjectHeight
                );
            } else {
                console.log('Center Crop - No content found, using full image');
                
                resultCanvas.width = targetWidth;
                resultCanvas.height = targetHeight;
                
                const scale = Math.min(targetWidth / originalImage.width, targetHeight / originalImage.height);
                const newWidth = originalImage.width * scale;
                const newHeight = originalImage.height * scale;
                const x = (targetWidth - newWidth) / 2;
                const y = (targetHeight - newHeight) / 2;
                
                console.log('Center Crop - Scale:', scale);
                console.log('Center Crop - New size:', newWidth, 'x', newHeight);
                console.log('Center Crop - Position:', x, y);
                
                resultCtx.drawImage(originalImage, x, y, newWidth, newHeight);
            }
            
            console.log('Center Crop - Result canvas size:', resultCanvas.width, 'x', resultCanvas.height);
        }

        function processMaskCircle() {
            const maskSize = parseInt(getSettingValue('setting-mask-size')) || 200;
            const position = getSettingValue('setting-mask-position') || 'center';

            let x, y;
            if (position === 'center') {
                x = (resultCanvas.width - maskSize) / 2;
                y = (resultCanvas.height - maskSize) / 2;
            } else if (position === 'top-left') {
                x = 0;
                y = 0;
            } else if (position === 'top-right') {
                x = resultCanvas.width - maskSize;
                y = 0;
            } else if (position === 'bottom-left') {
                x = 0;
                y = resultCanvas.height - maskSize;
            } else if (position === 'bottom-right') {
                x = resultCanvas.width - maskSize;
                y = resultCanvas.height - maskSize;
            }

            resultCtx.save();
            resultCtx.beginPath();
            resultCtx.arc(x + maskSize / 2, y + maskSize / 2, maskSize / 2, 0, Math.PI * 2);
            resultCtx.clip();
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            resultCtx.restore();
        }

        function processMaskSquare() {
            const maskSize = parseInt(getSettingValue('setting-mask-size')) || 200;
            const position = getSettingValue('setting-mask-position') || 'center';
            const cornerRadius = parseInt(getSettingValue('setting-corner-radius')) || 0;

            let x, y;
            if (position === 'center') {
                x = (resultCanvas.width - maskSize) / 2;
                y = (resultCanvas.height - maskSize) / 2;
            } else if (position === 'top-left') {
                x = 0;
                y = 0;
            } else if (position === 'top-right') {
                x = resultCanvas.width - maskSize;
                y = 0;
            } else if (position === 'bottom-left') {
                x = 0;
                y = resultCanvas.height - maskSize;
            } else if (position === 'bottom-right') {
                x = resultCanvas.width - maskSize;
                y = resultCanvas.height - maskSize;
            }

            resultCtx.save();
            resultCtx.beginPath();
            resultCtx.roundRect(x, y, maskSize, maskSize, cornerRadius);
            resultCtx.clip();
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            resultCtx.restore();
        }

        function processMaskCustom() {
            if (!maskCustomImage) {
                console.log('Custom mask - requires uploading a mask image');
                resultCtx.drawImage(originalImage, 0, 0);
                return;
            }
            
            resultCanvas.width = displayWidth;
            resultCanvas.height = displayHeight;
            
            resultCtx.save();
            resultCtx.drawImage(maskCustomImage, 0, 0, displayWidth, displayHeight);
            resultCtx.globalCompositeOperation = 'destination-in';
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            resultCtx.restore();
            
            console.log('Custom mask applied');
        }

        function processApplyAlphaMask() {
            if (!alphaMaskImage) {
                console.log('Apply Alpha Mask - requires uploading a mask image');
                resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
                return;
            }
            
            resultCanvas.width = displayWidth;
            resultCanvas.height = displayHeight;
            
            const maskCanvas = document.createElement('canvas');
            maskCanvas.width = displayWidth;
            maskCanvas.height = displayHeight;
            const maskCtx = maskCanvas.getContext('2d');
            
            maskCtx.drawImage(alphaMaskImage, 0, 0, displayWidth, displayHeight);
            const maskImageData = maskCtx.getImageData(0, 0, displayWidth, displayHeight);
            const maskData = maskImageData.data;
            
            resultCtx.drawImage(originalImage, 0, 0, displayWidth, displayHeight);
            const imageData = resultCtx.getImageData(0, 0, displayWidth, displayHeight);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const gray = (maskData[i] + maskData[i + 1] + maskData[i + 2]) / 3;
                data[i + 3] = gray;
            }
            
            resultCtx.putImageData(imageData, 0, 0);
            console.log('Alpha mask applied');
        }

        function processRemoveAlphaMask() {
            const bgColor = getSettingValue('setting-bg-color') || '#ffffff';
            
            resultCtx.fillStyle = bgColor;
            resultCtx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);
            resultCtx.drawImage(originalImage, 0, 0);
        }

        function handleUrlParams() {
            const pathname = window.location.pathname;
            const segments = pathname.split('/');
            const modeParam = segments[segments.length - 1];
            if (modeParam && modeParam !== 'Image-Background-Mask.html') {
                const modeBtn = document.querySelector(`.tool-btn[data-mode="${modeParam}"]`);
                if (modeBtn) {
                    modeBtn.click();
                }
            }
        }

        function init() {
            resultCanvas = document.getElementById('resultCanvas');
            resultCtx = resultCanvas.getContext('2d');
            setupEventListeners();
            handleUrlParams();
        }

        function setupEventListeners() {
            uploadBtn.addEventListener('click', function() {
                fileInput.click();
            });
            uploadPrompt.addEventListener('click', function() {
                fileInput.click();
            });
            fileInput.addEventListener('change', handleFileUpload);

            const canvasArea = document.querySelector('.canvas-area');
            canvasArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadPrompt.classList.add('drag-over');
            });

            canvasArea.addEventListener('dragleave', function() {
                uploadPrompt.classList.remove('drag-over');
            });

            canvasArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadPrompt.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    loadImage(files[0]);
                }
            });

            deleteImageBtn.addEventListener('click', function() {
                originalImage = null;
                displayWidth = 0;
                displayHeight = 0;
                uploadPrompt.style.display = 'flex';
                canvasWrapper.classList.remove('active');
                downloadBtn.disabled = true;
                resultCtx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                
                document.title = 'Background & Mask Tool | CaliperTools';
                const metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute('content', 'Process image backgrounds and masks with 13 professional tools. Remove backgrounds, add colors, apply masks, and more. No upload required.');
                }
                
                const newUrl = new URL(window.location.href);
                const segments = newUrl.pathname.split('/');
                const imageIndex = segments.indexOf('Image');
                
                const langCodes = ['bn', 'de', 'es', 'fr', 'hi', 'id', 'it', 'ja', 'ko', 'pt', 'ru', 'th', 'ur', 'vi', 'zh'];
                const langIndex = segments.findIndex(segment => langCodes.includes(segment));
                
                if (langIndex !== -1) {
                    newUrl.pathname = segments.slice(0, langIndex + 1).join('/') + '/Image/Image-Background-Mask.html';
                } else if (imageIndex !== -1) {
                    newUrl.pathname = segments.slice(0, imageIndex + 1).join('/') + '/Image-Background-Mask.html';
                } else {
                    newUrl.pathname = '/Image/Image-Background-Mask.html';
                }
                window.history.pushState({}, '', newUrl);
                
                toolButtons.forEach(function(b) {
                    b.classList.remove('active');
                });
                currentMode = null;
            });

            toolButtons.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const mode = btn.dataset.mode;
                    console.log('Button clicked:', mode);
                    
                    toolButtons.forEach(function(b) {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    currentMode = mode;
                    
                    const toolTitle = btn.dataset.title;
                    const toolDescription = btn.dataset.description;
                    
                    if (toolTitle) {
                        document.title = toolTitle + ' | CaliperTools';
                    }
                    
                    const newUrl = new URL(window.location.href);
                    const segments = newUrl.pathname.split('/');
                    const imageIndex = segments.indexOf('Image');
                    
                    const langCodes = ['bn', 'de', 'es', 'fr', 'hi', 'id', 'it', 'ja', 'ko', 'pt', 'ru', 'th', 'ur', 'vi', 'zh'];
                    const langIndex = segments.findIndex(segment => langCodes.includes(segment));
                    
                    if (langIndex !== -1) {
                        newUrl.pathname = segments.slice(0, langIndex + 1).join('/') + '/Image/Image-Background-Mask/' + mode;
                    } else if (imageIndex !== -1) {
                        newUrl.pathname = segments.slice(0, imageIndex + 1).join('/') + '/Image-Background-Mask/' + mode;
                    } else {
                        newUrl.pathname = '/Image/Image-Background-Mask/' + mode;
                    }
                    window.history.pushState({}, '', newUrl);
                    
                    const metaDescription = document.querySelector('meta[name="description"]');
                    if (metaDescription && toolDescription) {
                        metaDescription.setAttribute('content', toolDescription);
                    }
                    
                    updateSettingsPanel(mode);
                    processImages();
                });
            });

            document.addEventListener('change', function(e) {
                if (e.target.id.startsWith('setting-')) {
                    if (e.target.type !== 'color' && e.target.type !== 'range') {
                        console.log('Change event triggered:', e.target.id, e.target.value);
                        processImages();
                    }
                }
                if (e.target.id === 'mask-custom-file') {
                    handleMaskCustomUpload(e.target.files[0]);
                }
                if (e.target.id === 'alpha-mask-file') {
                    handleAlphaMaskUpload(e.target.files[0]);
                }
            });

            document.addEventListener('input', function(e) {
                console.log('Input event triggered:', e.target.id, e.target.value, e.target.type);
                
                if (e.target.id === 'setting-tolerance') {
                    document.getElementById('tolerance-display').textContent = e.target.value + '%';
                    processImages();
                }
                if (e.target.id === 'setting-mask-size') {
                    document.getElementById('mask-size-display').textContent = e.target.value + 'px';
                    processImages();
                }
                if (e.target.id === 'setting-corner-radius') {
                    document.getElementById('corner-radius-display').textContent = e.target.value + 'px';
                    processImages();
                }
            });

            document.addEventListener('change', function(e) {
                const colorPickers = ['setting-bg-color', 'setting-gradient-start', 'setting-gradient-end', 'setting-pattern-color1', 'setting-pattern-color2'];
                if (colorPickers.includes(e.target.id)) {
                    console.log('Color picker changed (change event):', e.target.id, e.target.value);
                    
                    if (e.target.id === 'setting-bg-color') {
                        canvasWrapper.style.backgroundColor = e.target.value;
                    }
                    
                    processImages();
                }
                
                if (e.target.id === 'setting-gradient-direction') {
                    console.log('Gradient direction changed:', e.target.value);
                    processImages();
                }
                if (e.target.id === 'setting-pattern') {
                    console.log('Pattern changed:', e.target.value);
                    processImages();
                }
            });

            clearBtn.addEventListener('click', clearAll);
            downloadBtn.addEventListener('click', downloadImage);
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                loadImage(file);
            }
        }

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    originalImage = img;
                    
                    const maxWidth = 800;
                    const maxHeight = 600;
                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth) {
                        height = (maxWidth / width) * height;
                        width = maxWidth;
                    }
                    if (height > maxHeight) {
                        width = (maxHeight / height) * width;
                        height = maxHeight;
                    }

                    displayWidth = width;
                    displayHeight = height;

                    resultCanvas.width = width;
                    resultCanvas.height = height;

                    resultCtx.drawImage(img, 0, 0, width, height);
                    
                    canvasWrapper.style.width = width + 'px';
                    canvasWrapper.style.height = height + 'px';

                    uploadPrompt.style.display = 'none';
                    canvasWrapper.classList.add('active');
                    downloadBtn.disabled = false;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        let maskCustomImage = null;
        let alphaMaskImage = null;

        function handleMaskCustomUpload(file) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    maskCustomImage = img;
                    const fileNameElement = document.getElementById('mask-custom-file-name');
                    if (fileNameElement) {
                        fileNameElement.textContent = file.name;
                    }
                    processImages();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function handleAlphaMaskUpload(file) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    alphaMaskImage = img;
                    const fileNameElement = document.getElementById('alpha-mask-file-name');
                    if (fileNameElement) {
                        fileNameElement.textContent = file.name;
                    }
                    processImages();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function clearAll() {
            if (originalImage) {
                if (confirm('Clear all images?')) {
                    originalImage = null;
                    displayWidth = 0;
                    displayHeight = 0;
                    uploadPrompt.style.display = 'flex';
                    canvasWrapper.classList.remove('active');
                    downloadBtn.disabled = true;
                    resultCtx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                    
                    document.title = 'Outil de Fond et Masque | CaliperTools';
                    const metaDescription = document.querySelector('meta[name="description"]');
                    if (metaDescription) {
                        metaDescription.setAttribute('content', 'Process image backgrounds and masks with 13 professional tools. Remove backgrounds, add colors, apply masks, and more. No upload required.');
                    }
                    
                    const newUrl = new URL(window.location.href);
                    const segments = newUrl.pathname.split('/');
                    const imageIndex = segments.indexOf('Image');
                    
                    const langCodes = ['bn', 'de', 'es', 'fr', 'hi', 'id', 'it', 'ja', 'ko', 'pt', 'ru', 'th', 'ur', 'vi', 'zh'];
                    const langIndex = segments.findIndex(segment => langCodes.includes(segment));
                    
                    if (langIndex !== -1) {
                        newUrl.pathname = segments.slice(0, langIndex + 1).join('/') + '/Image/Image-Background-Mask.html';
                    } else if (imageIndex !== -1) {
                        newUrl.pathname = segments.slice(0, imageIndex + 1).join('/') + '/Image-Background-Mask.html';
                    } else {
                        newUrl.pathname = '/Image/Image-Background-Mask.html';
                    }
                    window.history.pushState({}, '', newUrl);
                    
                    toolButtons.forEach(function(b) {
                        b.classList.remove('active');
                    });
                    currentMode = null;
                }
            }
        }

        function downloadImage() {
            if (!originalImage) return;

            const link = document.createElement('a');
            link.download = 'processed-image.png';
            link.href = resultCanvas.toDataURL('image/png');
            link.click();
        }

        init();
    </script>


</body>
</html>