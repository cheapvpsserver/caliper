<!DOCTYPE html>
<html lang="id-ID">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemampat Gambar Online Gratis | CaliperTools</title>
    <meta name="description" content="Kompresi gambar online gratis. Kompresi JPG, PNG, WebP cepat. Kurangi ukuran file secara instan. Tidak perlu unggah. Kualitas terbaik.">
    <link rel="canonical" href="https://www.example.com/image-compressor">
    <!-- Website Icon (Favicon) -->
    <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon32.png">
    <link rel="icon" href="../../images/favicon32.png" type="image/png">
    <!-- Add simple favicon.ico as default -->
    <link rel="shortcut icon" href="../../images/favicon32.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="../scripts/script.js"></script>
    <script>
        // URL parameter routing processing
        function handleUrlParams() {
            let mode = null;
            let format = null;
            let compression = null;
            let quality = null;
            
            // Parse from path first (new format)
            const pathname = window.location.pathname;
            const pathParts = pathname.split('/');
            const lastPart = pathParts[pathParts.length - 1];
            
            // Check if last part is a compression mode or format
            if (['lossy', 'lossless', 'compress-jpg', 'compress-png', 'compress-webp'].includes(lastPart)) {
                if (['lossy', 'lossless'].includes(lastPart)) {
                    compression = lastPart;
                } else {
                    mode = lastPart;
                }
            } else if (['jpg', 'png', 'webp'].includes(lastPart)) {
                format = lastPart;
            }
            
            // Fallback to query parameters for backward compatibility
            const urlParams = new URLSearchParams(window.location.search);
            if (!compression) compression = urlParams.get('compression');
            if (!mode) mode = urlParams.get('mode');
            if (!format) format = urlParams.get('format');
            if (!quality) quality = urlParams.get('quality');
            
            // Define SEO information for different modes
            const seoConfig = {
                'compress-jpg': {
                    title: 'Compress JPG Online Free | CaliperTools',
                    description: 'Compress JPG images online free. Fast JPEG compression. Reduce file size instantly. No upload needed. Best quality.',
                    h1: 'Compress JPG Image Online'
                },
                'compress-png': {
                    title: 'Compress PNG Online Free | CaliperTools',
                    description: 'Compress PNG images online free. Fast PNG compression. Reduce file size instantly. No upload needed. Best quality.',
                    h1: 'Compress PNG Image Online'
                },
                'compress-webp': {
                    title: 'Compress WebP Online Free | CaliperTools',
                    description: 'Compress WebP images online free. Fast WebP compression. Reduce file size instantly. No upload needed. Best quality.',
                    h1: 'Compress WebP Image Online'
                },
                'lossy': {
                    title: 'Lossy Image Compressor Online | CaliperTools',
                    description: 'Reduce image size fast online. Best quality compression. Free online tool. No upload needed. Instant results.',
                    h1: 'Lossy Image Compression Online'
                },
                'lossless': {
                    title: 'Lossless Image Compressor Online | CaliperTools',
                    description: 'Compress images without quality loss online. Perfect for web. Free online tool. No upload needed. Best results.',
                    h1: 'Lossless Image Compression Online'
                }
            };
            
            // Determine which SEO configuration to use
            let config;
            
            // If compression type is specified, use that SEO config
            if (compression) {
                config = seoConfig[compression] || seoConfig[mode] || {
                    title: 'Free Online Image Compressor | CaliperTools',
                    description: 'Compress images online free. Fast JPG, PNG, WebP compression. Reduce file size instantly. No upload needed. Best quality.',
                    h1: 'Image Compressor Online'
                };
            }
            // If a format is specified, use format-specific SEO config
            else if (format) {
                config = {
                    title: `Compress ${format.toUpperCase()} Online Free | CaliperTools`,
                    description: `Compress ${format.toUpperCase()} images online free. Fast compression. Reduce file size instantly. No upload needed. Best quality.`,
                    h1: `Compress ${format.toUpperCase()} Online`
                };
            }
            // Otherwise use mode-specific or default SEO config
            else {
                config = seoConfig[mode] || {
                    title: 'Free Online Image Compressor | CaliperTools',
                    description: 'Compress images online free. Fast JPG, PNG, WebP compression. Reduce file size instantly. No upload needed. Best quality.',
                    h1: 'Image Compressor Online'
                };
            }
            
            // Update title
            document.title = config.title;
            
            // Update meta description
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) {
                metaDesc.setAttribute('content', config.description);
            }
            
            // Update H1 title
            const h1 = document.getElementById('tool-title');
            if (h1) {
                h1.textContent = config.h1;
            }
            
            // Update UI based on URL parameters if needed
            // Set output format if specified
            if (format) {
                const outputFormatSelect = document.getElementById('output-format');
                if (outputFormatSelect) {
                    outputFormatSelect.value = format;
                }
            }
            
            // Set compression mode if specified
            if (compression) {
                const lossyRadio = document.getElementById('lossy-compression');
                const losslessRadio = document.getElementById('lossless-compression');
                if (lossyRadio && losslessRadio) {
                    if (compression === 'lossy') {
                        lossyRadio.checked = true;
                    } else if (compression === 'lossless') {
                        losslessRadio.checked = true;
                    }
                    updateQualitySliderVisibility();
                }
            }
            
            // Set quality if specified
            if (quality) {
                const qualitySlider = document.getElementById('quality-slider');
                const qualityDisplay = document.getElementById('quality-display');
                if (qualitySlider && qualityDisplay) {
                    qualitySlider.value = quality;
                    qualityDisplay.textContent = `${quality}%`;
                }
            }
            
            console.log(`Switched to mode: ${mode || 'default'}, format: ${format || 'original'}, compression: ${compression || 'default'}`);
        }
        
        // Handle URL parameters when page loads
        window.addEventListener('load', handleUrlParams);
        
        // Listen for function button clicks to update URL and SEO information
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for compression mode radio buttons
            const compressionRadios = document.querySelectorAll('input[name="compression-mode"]');
            compressionRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const newUrl = new URL(window.location.href);
                    newUrl.search = '';
                    
                    const pathParts = newUrl.pathname.split('/');
                    const compressorIndex = pathParts.findIndex(part => part === 'Image-Compression' || part === 'Image-Compression.html');
                    
                    if (compressorIndex !== -1) {
                        // Remove .html suffix from the filename
                        const basePath = pathParts.slice(0, compressorIndex).join('/') + '/Image-Compression';
                        newUrl.pathname = basePath + '/' + this.value;
                    }
                    
                    window.history.pushState({}, '', newUrl);
                    handleUrlParams();
                });
            });
            
            // Add event listener for output format select box
            const outputFormatSelect = document.getElementById('output-format');
            if (outputFormatSelect) {
                outputFormatSelect.addEventListener('change', function() {
                    const newUrl = new URL(window.location.href);
                    newUrl.search = '';
                    
                    const pathParts = newUrl.pathname.split('/');
                    const compressorIndex = pathParts.findIndex(part => part === 'Image-Compression' || part === 'Image-Compression.html');
                    
                    if (compressorIndex !== -1) {
                        // Remove .html suffix from the filename
                        const basePath = pathParts.slice(0, compressorIndex).join('/') + '/Image-Compression';
                        if (this.value === 'original') {
                            newUrl.pathname = basePath;
                        } else {
                            newUrl.pathname = basePath + '/' + this.value;
                        }
                    }
                    
                    window.history.pushState({}, '', newUrl);
                    handleUrlParams();
                });
            }
        });
    </script>
    <style>
/* Basic Style Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
}

/* Container Style */
.image-compressor-container {
    display: flex;
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    background-color: #fff;
    height: 850px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .image-compressor-container {
        flex-direction: column;
        height: auto;
    }

    .sidebar-container {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #ddd;
    }

    .sidebar {
        height: auto;
        max-height: 500px;
    }

    .gallery {
        height: auto;
        max-height: 500px;
    }

    .export-area {
        width: 100%;
        float: none;
    }
}

@media (max-width: 480px) {
    .compression-settings {
        padding: 10px;
    }

    .dimension-group, .percentage-group {
        flex-direction: column;
    }

    .dimension-group input, .dimension-group select, .percentage-group select {
        width: 100%;
        margin-bottom: 5px;
    }
}

/* Left Sidebar - Scroll Functionality */
.sidebar-container {
    width: 380px;
    border-right: 1px solid #ddd;
}

.sidebar {
    padding: 20px;
    background-color: #ffffff;
    height: 750px;
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
}

.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.sidebar::-webkit-scrollbar-thumb {
    background: #bbb;
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: #999;
}

.upload-section {
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.upload-btn {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 10px 20px;
    font-size: 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.upload-btn:hover {
    background-color: #0056b3;
}

.delete-btn {
    background: none;
    border: none;
    color: #dc3545;
    font-size: 20px;
    cursor: pointer;
    transition: color 0.3s ease;
}

.delete-btn:hover {
    color: #b21f2d;
}

.file-input {
    display: none;
}

/* Compression Settings */
.compression-settings, .export-settings {
    margin-bottom: 20px;
}

.compression-settings {
    margin-top: 30px;
}

h2 {
    font-size: 18px;
    margin-bottom: 15px;
    color: #0F172A;
}

/* Compression Mode Radio Buttons */
.compression-mode {
    margin-bottom: 20px;
}

.compression-mode h3 {
    font-size: 16px;
    margin-bottom: 10px;
    color: #4b5563;
}

.radio-group {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.radio-option {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.radio-option input[type="radio"] {
    margin-right: 8px;
    width: auto;
}

/* Quality Slider */
.quality-control {
    margin-bottom: 20px;
}

.quality-control h3 {
    font-size: 16px;
    margin-bottom: 10px;
    color: #4b5563;
}

.quality-slider-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    width: 100%;
}

.quality-slider {
    flex: 1;
    height: 8px;
    -webkit-appearance: none;
    appearance: none;
    background: #ddd;
    outline: none;
    border-radius: 4px;
}

.quality-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
}

.quality-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
    border: none;
}

#quality-display {
    width: 40px;
    text-align: right;
    font-weight: bold;
    color: #007bff;
}

/* Max Dimension Select */
.max-dimension {
    margin-bottom: 20px;
}

.max-dimension h3 {
    font-size: 16px;
    margin-bottom: 10px;
    color: #4b5563;
}

#max-dimension {
    width: 100%;
    padding: 12px 8px;
    border: 1px solid #ddd;
    height: 44px;
    font-size: 16px;
}

/* Output Format Select */
.output-format {
    margin-bottom: 20px;
}

.output-format h3 {
    font-size: 16px;
    margin-bottom: 10px;
    color: #4b5563;
}

#output-format {
    width: 100%;
    padding: 12px 8px;
    border: 1px solid #ddd;
    height: 44px;
    font-size: 16px;
}

/* New Area Below Left Menu Function Area - Export Area */
.export-area {
    width: 333px;
    background-color: #f9f9f9;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #ddd;
    margin-top: 20px;
    clear: both;
    display: block;
    float: left;
    margin-left: 20px;
}

.export-actions {
    display: flex;
    gap: 10px;
    width: 100%;
    box-sizing: border-box;
}

/* Export and ZIP Button Style Optimization */
.export-btn, .zip-btn {
    font-size: 18px;
    padding: 15px 20px;
    height: auto;
    font-weight: bold;
    transition: all 0.2s ease;
    white-space: nowrap;
    min-width: 0;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}

.export-btn {
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
    flex: 1;
}

.zip-btn {
    background-color: #28a745;
    color: #fff;
    border: none;
    cursor: pointer;
    flex: 1;
}

.export-btn:hover, .zip-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* Responsive Design for Export Buttons */
@media (max-width: 768px) {
    .export-area {
        width: calc(100% - 40px); /* Full width with margin */
        float: none;
        margin: 20px auto;
        padding: 15px;
    }
    
    .export-actions {
        flex-direction: column;
        gap: 10px;
    }
    
    .export-btn, .zip-btn {
        font-size: 16px;
        padding: 12px 15px;
        width: 100%;
        flex: none;
    }
}

/* Additional responsive adjustment for smaller screens */
@media (max-width: 480px) {
    .export-area {
        padding: 10px;
        margin: 15px 10px;
        width: calc(100% - 20px);
    }
    
    .export-btn, .zip-btn {
        font-size: 14px;
        padding: 10px 12px;
    }
    
    .export-btn i, .zip-btn i {
        font-size: 14px;
    }
}

/* Right Side Image Browser Window */
.gallery {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    height: 850px;
    display: flex;
    flex-direction: column;
}

.upload-prompt {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    border: 2px dashed #ccc;
    border-radius: 8px;
    margin: 20px;
    transition: all 0.3s ease;
}

.upload-prompt.drag-over {
    border-color: #007bff;
    background-color: rgba(0, 123, 255, 0.05);
}

.upload-prompt-icon {
    font-size: 60px;
    color: #007bff;
    margin-bottom: 20px;
}

.upload-prompt-title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 15px;
    color: #0F172A;
}

.upload-prompt-instruction {
    font-size: 16px;
    margin-bottom: 20px;
    color: #666;
}

.supported-formats {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    font-size: 14px;
    max-width: 450px;
}

.format-item {
    color: #555;
}

.more-formats {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #007bff;
    cursor: pointer;
    margin-bottom: 20px;
    font-size: 14px;
}

.formats-tooltip {
    position: relative;
    display: inline-block;
}

.formats-tooltip .tooltip-text {
    visibility: hidden;
    width: 300px;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 10px;
    position: absolute;
    z-index: 100;
    bottom: 125%;
    left: 50%;
    margin-left: -150px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 12px;
    text-align: left;
    line-height: 1.5;
}

.formats-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

.recommendation {
    font-size: 14px;
    color: #666;
    margin-bottom: 8px;
}

.image-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
}

.image-item {
    width: calc(25% - 15px);
    height: 350px;
    margin-bottom: 20px;
    border: 1px solid #ddd;
    padding: 10px;
    position: relative;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.3s ease;
}

.image-item:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.image-preview-container {
    flex: 1;
    height: 220px;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-color: #f9f9f9;
    margin-bottom: 10px;
    position: relative;
}

.image-item img {
    max-width: 100% !important;
    max-height: 100% !important;
    width: auto !important;
    height: auto !important;
    object-fit: contain !important;
    display: block !important;
    transform: none !important;
    transition: none !important;
}

.image-actions {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 5px;
}

.image-action-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.8);
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 14px;
    color: #0F172A;
    transition: all 0.2s ease;
    position: relative;
}

.image-action-btn:hover {
    background-color: white;
    transform: scale(1.1);
}

.image-action-btn .tooltip {
    visibility: hidden;
    width: auto;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 12px;
    white-space: nowrap;
}

.image-action-btn:hover .tooltip {
    visibility: visible;
    opacity: 1;
}

.info-btn:hover {
    color: #ffc107;
}

.delete-img-btn:hover {
    color: #dc3545;
}

.image-info {
    display: flex;
    flex-direction: column;
    margin-bottom: 5px;
    font-size: 13px;
}

.image-name {
    margin-bottom: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.size-info {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
}

.original-size {
    color: #555;
}

.compressed-size {
    color: #10b981;
}

.compression-info {
    font-size: 12px;
    color: #007bff;
    margin-bottom: 5px;
}

.comparison-section {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.before-after {
    flex: 1;
    font-size: 11px;
    text-align: center;
    color: #666;
}

.before-after-label {
    font-weight: bold;
    margin-bottom: 3px;
}

.before-after-size {
    color: #333;
}

/* Privacy Statement */
.privacy-statement {
    margin-top: 20px;
    padding: 15px;
    background-color: #f0f9ff;
    border-left: 4px solid #3b82f6;
    border-radius: 4px;
    font-size: 14px;
    color: #1e40af;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .image-item {
        width: calc(33.333% - 14px);
    }
}

@media (max-width: 992px) {
    .image-item {
        width: calc(50% - 10px);
    }
}

@media (max-width: 640px) {
    .image-compressor-container {
        flex-direction: column;
    }

    .sidebar-container {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #ddd;
        order: 2;
    }

    .sidebar {
        height: auto;
        max-height: 70vh;
    }

    .gallery {
        width: 100%;
        order: 1;
        height: auto;
        max-height: 50vh;
    }
}

@media (max-width: 375px) {
    .image-item {
        width: 100%;
    }
    
    .supported-formats {
        gap: 8px;
        font-size: 12px;
    }
    
    .radio-group {
        flex-direction: column;
        gap: 10px;
    }
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal.show {
    display: block;
    opacity: 1;
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 300px;
    text-align: center;
    border-radius: 5px;
    transform: translateY(-20px);
    transition: transform 0.3s ease;
}

.modal-content p {
    margin: 0 0 20px 0;
    font-size: 16px;
    color: #333;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
}

.modal-btn:hover {
    transform: scale(1.05);
}

.cancel-btn {
    background-color: #6c757d;
    color: white;
}

.cancel-btn:hover {
    background-color: #5a6268;
}

.confirm-btn {
    background-color: #dc3545;
    color: white;
}

.confirm-btn:hover {
    background-color: #c82333;
}

        /* Tutorial and Introduction Section Styles */
        .tutorial-section {
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            color: white;
            padding: 5rem 0;
            margin-top: 5rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .text-4xl {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 4rem;
        }

        .grid {
            display: grid;
            gap: 2rem;
        }

        .grid-cols-1 {
            grid-template-columns: 1fr;
        }

        @media (min-width: 640px) {
            .sm\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .lg\:grid-cols-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .tutorial-card {
            background: white;
            color: #1f2937;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .tutorial-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .tutorial-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .tutorial-icon {
            background: #3b82f6;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.25rem;
        }

        .tutorial-card p {
            color: #6b7280;
            line-height: 1.5;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            cursor: help;
            font-size: 0.875rem;
        }

        /* Feature Section Styles */
        .feature-section {
            padding: 5rem 0;
            background: white;
        }

        .feature-section.gray {
            background: #f9fafb;
        }

        .grid-cols-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 4rem;
            align-items: center;
        }

        @media (min-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .content-image img {
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        .content-text h2 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        .content-text p {
            font-size: 1.125rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            line-height: 1.75;
        }

        /* Order Classes */
        .order-2 {
            order: 2;
        }

        .order-1 {
            order: 1;
        }

        @media (min-width: 768px) {
            .md\:order-1 {
                order: 1;
            }
            .md\:order-2 {
                order: 2;
            }
        }

        /* Bottom Text Area */
        .bottom-text-section {
            padding: 5rem 0;
            background: linear-gradient(to bottom, #f9fafb, white);
        }

        .bottom-text-section h2 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        .bottom-text-section p {
            font-size: 1.125rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            line-height: 1.75;
        }

        .mb-10 {
            margin-bottom: 2.5rem;
        }

        /* Related Tools Section */
        .related-tools {
            padding: 4rem 0;
            background: white;
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 3rem;
            text-align: center;
        }

        /* Text Alignment Classes */
        .text-center {
            text-align: center;
        }
    </style>
<script>  
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        alert('Menu klik kanan dinonaktifkan');
    });

    document.addEventListener('selectstart', function(e) {
        e.preventDefault();
    });

    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'u' || e.key === 's' || e.key === 'a')) {
            e.preventDefault();
            alert('Fungsi salin dinonaktifkan');
        }
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
            e.preventDefault();
            alert('Alat pengembang dinonaktifkan');
        }
    });
</script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col font-sans">
    <main class="main">
        <div style="padding: 2rem 0;">
            <h1 id="tool-title" class="text-3xl font-bold text-center mb-8">Pemampat Gambar Online</h1>
        </div>
        <div class="image-compressor-container">
                    <!-- Left Side Menu Container -->
                    <div class="sidebar-container">
                        <div class="sidebar">
                            <div class="upload-section">
                                <button id="upload-btn" class="upload-btn">+</button>
                                <input type="file" id="file-input" class="file-input" multiple accept="image/jpeg,image/png,image/webp">
                                <button id="delete-all-btn" class="delete-btn"><i class="fas fa-trash"></i></button>
                            </div>
                            <p>Ukuran File Maksimal: 10 MB</p>

                <div class="compression-settings">
                    <h2>Pengaturan Kompresi</h2>
                    
                    <!-- Compression Mode -->
                    <div class="compression-mode">
                        <h3>Mode Kompresi</h3>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="compression-mode" id="lossy-compression" value="lossy" checked>
                                Lossy (Dapat mengurangi kualitas)
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="compression-mode" id="lossless-compression" value="lossless">
                                Lossless (Tanpa kehilangan kualitas)
                            </label>
                        </div>
                    </div>
                    
                    <!-- Quality Slider -->
                    <div id="quality-control" class="quality-control">
                        <h3>Kualitas</h3>
                        <div class="quality-slider-container">
                            <input type="range" id="quality-slider" class="quality-slider" min="10" max="100" value="80">
                            <span id="quality-display">80%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>Rendah</span>
                            <span>Sedang</span>
                            <span>Tinggi</span>
                        </div>
                    </div>
                    
                    <!-- Max Dimension -->
                    <div class="max-dimension">
                        <h3>Dimensi Maksimal</h3>
                        <select id="max-dimension">
                            <option value="keep">Pertahankan asli</option>
                            <option value="1920">1920</option>
                            <option value="1280">1280</option>
                            <option value="1024">1024</option>
                        </select>
                    </div>
                    
                    <!-- Output Format -->
                    <div class="output-format">
                        <h3>
                            Format Keluaran
                            <span class="formats-tooltip">
                                <i class="fas fa-question-circle" style="margin-left: 5px; color: #007bff; cursor: help;"></i>
                                <span class="tooltip-text">PNG adalah lossless dan dapat menghasilkan ukuran file yang lebih besar daripada gambar asli.</span>
                            </span>
                        </h3>
                        <select id="output-format">
                            <option value="keep">Pertahankan asli</option>
                            <option value="webp">Konversi ke WebP</option>
                            <option value="jpg">Konversi ke JPG</option>
                            <option value="png">Konversi ke PNG</option>
                        </select>
                    </div>
                    
                    <!-- Privacy Statement -->
                    <div class="privacy-statement">
                        <i class="fas fa-shield-alt" style="margin-right: 8px;"></i>
                        File diproses secara lokal dan dihapus secara otomatis setelah diproses.
                    </div>
                </div>

                <!-- Export settings section removed as requested -->
            </div>

        <!-- Export Area -->
        <div class="export-area">
            <div class="export-actions">
                <button id="export-btn" class="export-btn"><i class="fas fa-download"></i> Ekspor</button>
                <button id="zip-btn" class="zip-btn"><i class="fas fa-file-archive"></i> Arsip ZIP</button>
            </div>
    </div>
    </div>

        <!-- Right Side Image Browser Window -->
        <div class="gallery">
            <div id="upload-prompt" class="upload-prompt">
                <div class="upload-prompt-icon">
                    <i class="fas fa-image"></i>
                </div>
                <div class="upload-prompt-title">Pemampat Gambar Multi-File</div>
                <div class="upload-prompt-instruction">Klik "+" di kiri atas, seret & lepas, atau Ctrl+V untuk mengunggah gambar</div>
                <div class="supported-formats">
                    <div class="format-item">✅ jpg</div>
                    <div class="format-item">✅ png</div>
                    <div class="format-item">✅ webp</div>
                </div>
                <div class="recommendation">Total File yang Direkomendasikan: &lt; 100</div>
                <div class="recommendation">Ukuran File yang Direkomendasikan: &lt; 10Mb</div>
            </div>
            
            <div id="image-container" class="image-container">
                <!-- Images will be dynamically added via JavaScript -->
            </div>
        </div>
    </div>
    </div>

    <!-- Tutorial Section -->
    <section class="tutorial-section">
        <div class="container">
            <h2 class="text-4xl">Cara Menggunakan Pemampat Gambar</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Step 1 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </span>
                        Unggah Gambar
                    </h3>
                    <p title="Seret dan lepas gambar langsung ke area unggahan atau klik tombol '+' untuk memilih dari perangkat Anda. Alat kami mendukung banyak gambar dan berbagai format termasuk JPG, PNG, dan WebP.">Seret dan lepas gambar langsung ke area unggahan atau klik tombol "+" untuk memilih dari perangkat Anda. Alat kami mendukung banyak gambar dan berbagai format termasuk JPG, PNG, dan WebP.</p>
                </div>
                <!-- Step 2 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-sliders-h"></i>
                        </span>
                        Pilih Opsi
                    </h3>
                    <p title="Pilih antara kompresi Lossy atau Lossless. Sesuaikan penggeser kualitas untuk kompresi lossy. Atur dimensi maksimal dan format keluaran sesuai kebutuhan Anda.">Pilih antara kompresi Lossy atau Lossless. Sesuaikan penggeser kualitas untuk kompresi lossy. Atur dimensi maksimal dan format keluaran sesuai kebutuhan Anda.</p>
                </div>
                <!-- Step 3 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-compress-alt"></i>
                        </span>
                        Kompresi Gambar
                    </h3>
                    <p title="Klik 'Ekspor' untuk mengompresi dan mengunduh gambar secara individual, atau 'Arsip ZIP' untuk mengunduh semua gambar yang dikompresi dalam satu file ZIP.">Klik "Ekspor" untuk mengompresi dan mengunduh gambar secara individual, atau "Arsip ZIP" untuk mengunduh semua gambar yang dikompresi dalam satu file ZIP.</p>
                </div>
                <!-- Step 4 -->
                <div class="tutorial-card">
                    <h3>
                        <span class="tutorial-icon">
                            <i class="fas fa-eye"></i>
                        </span>
                        Lihat Hasil
                    </h3>
                    <p title="Lihat perbandingan ukuran sebelum/sesudah dan rasio kompresi untuk setiap gambar. Unduh gambar yang dikompresi secara instan.">Lihat perbandingan ukuran sebelum/sesudah dan rasio kompresi untuk setiap gambar. Unduh gambar yang dikompresi secara instan.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Feature Introduction Section -->
    <section class="feature-section">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-image">
                    <img src="https://plus.unsplash.com/premium_photo-1698081930248-59530973dcd9?w=600&h=400&fit=crop" alt="Image Compressor" class="rounded-xl shadow-2xl w-full">
                </div>
                <div class="content-text">
                    <h2>Kompresi Gambar yang Kuat</h2>
                    <p>Kompresi gambar dengan presisi dan mudah. Alat kami mendukung kompresi lossy dan lossless, memungkinkan Anda untuk menyeimbangkan ukuran file dan kualitas gambar sesuai kebutuhan Anda.</p>
                    <p>Baik Anda perlu mengurangi ukuran gambar untuk optimasi web, lampiran email, atau penyimpanan, pemampat kami memberikan hasil profesional dengan usaha minimal.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Quality and Size Adjustment Section -->
    <section class="feature-section gray">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-text order-2 md:order-1">
                    <h2>Sesuaikan Gambar Anda</h2>
                    <p>Sesuaikan kualitas gambar dari 10% hingga 100% untuk menyeimbangkan antara ukuran file dan kualitas visual. Ubah ukuran gambar dengan persentase untuk memenuhi kebutuhan Anda secara sempurna.</p>
                    <p>Untuk format PNG dan WebP, Anda juga dapat menghapus latar belakang secara otomatis, menjadikan gambar Anda lebih serbaguna untuk berbagai kasus penggunaan.</p>
                </div>
                <div class="content-image order-1 md:order-2">
                    <img src="https://plus.unsplash.com/premium_photo-1682141390385-01da7bc2c0c9?w=600&h=400&fit=crop" alt="Image Customization" class="rounded-xl shadow-2xl w-full">
                </div>
            </div>
        </div>
    </section>

    <!-- Batch Compression Section -->
    <section class="feature-section">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-image">
                    <img src="https://plus.unsplash.com/premium_photo-1684611913924-c390a2d76abf?w=600&h=400&fit=crop" alt="Batch Compression" class="rounded-xl shadow-2xl w-full">
                </div>
                <div class="content-text">
                    <h2>Dukungan Kompresi Batch</h2>
                    <p>Kompresi beberapa gambar sekaligus, menghemat waktu dan tenaga Anda. Cukup unggah semua gambar Anda, atur pengaturan kompresi pilihan Anda, dan biarkan alat kami menangani sisanya.</p>
                    <p>Lacak hasil kompresi secara real-time dan unduh semua gambar yang dikompresi secara individual atau sebagai file ZIP yang nyaman untuk berbagi dan penyimpanan yang mudah.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Mobile Support Section -->
    <section class="feature-section gray">
        <div class="container">
            <div class="grid-cols-2">
                <div class="content-text order-2 md:order-1">
                    <h2>Desain Ramah Seluler</h2>
                    <p>Kompresi gambar secara mobile dengan desain ramah seluler kami. Alat kami bekerja tanpa hambatan di smartphone dan tablet, memungkinkan Anda mengompresi gambar di mana saja Anda berada.</p>
                    <p>Dengan antarmuka yang responsif yang menyesuaikan dengan ukuran layar apa pun, Anda dapat dengan mudah mengunggah, mengompresi, dan mengunduh gambar menggunakan perangkat mobile Anda. Tidak ada aplikasi untuk diinstal, cukup buka peramban Anda dan mulai mengompresi.</p>
                </div>
                <div class="content-image order-1 md:order-2">
                    <img src="https://images.unsplash.com/photo-1586953208448-b95a79798f07?w=600&h=400&fit=crop" alt="Mobile-Friendly Design" class="rounded-xl shadow-2xl w-full">
                </div>
            </div>
        </div>
    </section>

    <!-- Bottom Text Section -->
    <section class="bottom-text-section">
        <div class="container">
            <h2>Kompresi gambar secara mudah dan gratis</h2>
            <p>Ucapkan selamat tinggal pada penggunaan perangkat lunak kompleks untuk mengompresi gambar. Dengan Pemampat Gambar CaliperTools, Anda dapat dengan mudah mengurangi ukuran file gambar Anda secara gratis. Bagian terbaiknya adalah Anda dapat menggunakan alat kami dari perangkat apa pun dengan peramban, tidak perlu mengunduh atau menginstal. Tidak perlu pengalaman!</p>
            <p class="mb-10">Gunakan editor seret-dan-lepas untuk mengunggah gambar Anda, dan Pemampat Gambar CaliperTools akan menangani sisanya. Setelah selesai, unduh gambar yang dikompresi secara individual atau sebagai file ZIP. Kompresi sebanyak mungkin gambar seperti yang Anda inginkan, semua hanya dalam beberapa klik.</p>
            
            <h2>Kompresi berkualitas tinggi setiap saat</h2>
            <p>Jaga kualitas gambar Anda sambil mengurangi ukuran file. Algoritma canggih kami memastikan bahwa gambar Anda mempertahankan kejelasan dan detailnya, apakah Anda menggunakan kompresi lossy atau lossless.</p>
            <p>Dengan opsi kustomisasi bawaan kami, Anda dapat menyesuaikan kualitas, mengatur dimensi maksimal, dan bahkan mengonversi antar format untuk membuat gambar Anda menonjol. Tingkatkan foto Anda dan tingkatkan kinerja web dengan gambar yang dikompresi secara sempurna.</p>
        </div>
    </section>

    <!-- Related Tools -->
    <section class="related-tools">
        <div class="container">
            <h2 class="section-title">Alat Terkait</h2>
            <div class="tools-grid" id="relatedTools">
                <!-- Related tools will be dynamically generated by JS -->
            </div>
        </div>
    </section>

    </main>

    <!-- Related Tools Script -->
    <script src="../scripts/script-related-tools.js"></script>
    <script>
        // Initialize related tools
        document.addEventListener('DOMContentLoaded', function() {
            const currentSlug = 'image-compressor';
            if (typeof initRelatedTools === 'function') {
                initRelatedTools(currentSlug);
            }
        });
    </script>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <p>Hapus semua gambar?</p>
            <div class="modal-buttons">
                <button id="cancel-delete" class="modal-btn cancel-btn">Batal</button>
                <button id="confirm-delete" class="modal-btn confirm-btn">Konfirmasi</button>
            </div>
        </div>
    </div>

    <!-- Single Image Delete Confirmation Modal -->
    <div id="delete-image-modal" class="modal">
        <div class="modal-content">
            <p>Apakah Anda yakin ingin menghapus gambar ini?</p>
            <div class="modal-buttons">
                <button id="cancel-delete-image" class="modal-btn cancel-btn">Batal</button>
                <button id="confirm-delete-image" class="modal-btn confirm-btn">Konfirmasi</button>
            </div>
        </div>
    </div>

    <script>
// Ensure DOM is fully loaded before execution
document.addEventListener('DOMContentLoaded', function() {
    // DOM element cache
    const elements = {
        // Upload related
        uploadBtn: document.getElementById('upload-btn'),
        fileInput: document.getElementById('file-input'),
        deleteAllBtn: document.getElementById('delete-all-btn'),
        uploadPrompt: document.getElementById('upload-prompt'),
        imageContainer: document.getElementById('image-container'),
        
        // Export related
        exportBtn: document.getElementById('export-btn'),
        zipBtn: document.getElementById('zip-btn'),
        
        // Compression settings related
        lossyRadio: document.getElementById('lossy-compression'),
        losslessRadio: document.getElementById('lossless-compression'),
        qualitySlider: document.getElementById('quality-slider'),
        qualityDisplay: document.getElementById('quality-display'),
        qualityControl: document.getElementById('quality-control'),
        maxDimensionSelect: document.getElementById('max-dimension'),
        outputFormatSelect: document.getElementById('output-format'),
        
        // Modal related
        deleteModal: document.getElementById('delete-modal'),
        cancelDeleteBtn: document.getElementById('cancel-delete'),
        confirmDeleteBtn: document.getElementById('confirm-delete'),
        deleteImageModal: document.getElementById('delete-image-modal'),
        cancelDeleteImageBtn: document.getElementById('cancel-delete-image'),
        confirmDeleteImageBtn: document.getElementById('confirm-delete-image'),
    };

    // Store uploaded image information
    let uploadedImages = [];
    let currentCompressionMode = 'lossy'; // Currently active compression mode
    let currentQuality = 80; // Current quality setting
    let imageToDelete = -1; // Index of image to delete

    // Initialize
    function init() {
        // Verify all required elements exist
        if (!validateElements()) {
            console.error('Elemen DOM penting hilang, tidak dapat menginisialisasi aplikasi');
            return;
        }
        
        // Set up event listeners
        setupEventListeners();
        
        // Initially hide image container
        elements.imageContainer.style.display = 'none';
    }

    // Validate necessary DOM elements exist
    function validateElements() {
        for (const [key, element] of Object.entries(elements)) {
            if (element === null || element === undefined) {
                console.error(`Elemen DOM yang dibutuhkan hilang: ${key}`);
                return false;
            }
        }
        return true;
    }

    // Set up all event listeners
    function setupEventListeners() {
        // Upload images
        elements.uploadBtn.addEventListener('click', () => {
            elements.fileInput.click();
        });

        elements.fileInput.addEventListener('change', handleFileUpload);

        // Click on upload prompt to open file dialog
        elements.uploadPrompt.addEventListener('click', () => {
            elements.fileInput.click();
        });

        // Drag and drop upload
        const gallery = document.querySelector('.gallery');
        gallery.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.uploadPrompt.classList.add('drag-over');
        });

        gallery.addEventListener('dragleave', () => {
            elements.uploadPrompt.classList.remove('drag-over');
        });

        gallery.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.uploadPrompt.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length) {
                handleFiles(files);
            }
        });

        // Copy and paste upload
        document.addEventListener('paste', (e) => {
            const items = (e.clipboardData || e.originalEvent.clipboardData).items;
            for (let item of items) {
                if (item.kind === 'file') {
                    const file = item.getAsFile();
                    if (file.type.startsWith('image/')) {
                        handleFiles([file]);
                    }
                }
            }
        });

        // Delete all images related
        elements.deleteAllBtn.addEventListener('click', () => {
            if (uploadedImages.length > 0) {
                elements.deleteModal.classList.add('show');
            }
        });

        elements.cancelDeleteBtn.addEventListener('click', () => {
            elements.deleteModal.classList.remove('show');
        });

        elements.confirmDeleteBtn.addEventListener('click', () => {
            elements.imageContainer.innerHTML = '';
            uploadedImages = [];
            updateUIVisibility();
            
            // Clear file input to allow re-uploading the same file
            elements.fileInput.value = '';
            
            // Reset all compression settings to initial state
            currentCompressionMode = 'lossy';
            currentQuality = 80;
            
            // Reset UI controls
            elements.lossyRadio.checked = true;
            elements.losslessRadio.checked = false;
            elements.qualitySlider.value = 80;
            elements.qualityDisplay.textContent = '80%';
            elements.maxDimensionSelect.value = 'keep';
            elements.outputFormatSelect.value = 'keep';
            
            // Update quality slider visibility
            updateQualitySliderVisibility();
            
            // Restore default SEO information
            document.title = 'Pemampat Gambar Online Gratis | CaliperTools';
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) {
                metaDesc.setAttribute('content', 'Kompresi gambar online gratis. Kompresi JPG, PNG, WebP cepat. Kurangi ukuran file secara instan. Tidak perlu unggah. Kualitas terbaik.');
            }
            const h1 = document.getElementById('tool-title');
            if (h1) {
                h1.textContent = 'Pemampat Gambar Online';
            }
            
            // When no images remain, completely restore to clean URL// When no images remain, completely restore to clean URL with .html suffix
            const newUrl = new URL(window.location.href);
            newUrl.search = '';
            
            const pathParts = newUrl.pathname.split('/');
            const compressorIndex = pathParts.findIndex(part => part === 'Image-Compression' || part === 'Image-Compression.html');
            
            if (compressorIndex !== -1) {
                // Use Image-Compression.html with .html suffix explicitly
                const basePath = pathParts.slice(0, compressorIndex).join('/');
                newUrl.pathname = basePath + '/Image-Compression.html';
            }
            window.history.pushState({}, '', newUrl);
            
            // Manually reset output format to 'keep'
            const outputFormatSelect = document.getElementById('output-format');
            if (outputFormatSelect) {
                outputFormatSelect.value = 'keep';
            }
            
            elements.deleteModal.classList.remove('show');
        });

        // Compression mode change
        elements.lossyRadio.addEventListener('change', async () => {
            currentCompressionMode = 'lossy';
            updateQualitySliderVisibility();
            await updateAllCompressionResults();
        });

        elements.losslessRadio.addEventListener('change', async () => {
            currentCompressionMode = 'lossless';
            updateQualitySliderVisibility();
            await updateAllCompressionResults();
        });

        // Quality slider change
        elements.qualitySlider.addEventListener('input', async (e) => {
            currentQuality = parseInt(e.target.value);
            elements.qualityDisplay.textContent = `${currentQuality}%`;
            await updateAllCompressionResults();
        });

        // Max dimension change
        elements.maxDimensionSelect.addEventListener('change', async () => {
            await updateAllCompressionResults();
        });

        // Output format change
        elements.outputFormatSelect.addEventListener('change', async () => {
            await updateAllCompressionResults();
        });

        // Export functionality
        elements.exportBtn.addEventListener('click', () => {
            if (uploadedImages.length === 0) {
                alert('Please upload images first');
                return;
            }
            
            // Process and download each image
            uploadedImages.forEach(image => {
                processAndDownloadImage(image);
            });
        });

        // ZIP archive functionality
        elements.zipBtn.addEventListener('click', () => {
            if (uploadedImages.length === 0) {
                alert('Please upload images first');
                return;
            }
            
            createZipArchive();
        });

        // Single image deletion related
        elements.imageContainer.addEventListener('click', (e) => {
            const deleteBtn = e.target.closest('.delete-img-btn');
            if (deleteBtn) {
                const index = parseInt(deleteBtn.dataset.index);
                elements.deleteImageModal.classList.add('show');
                imageToDelete = index;
            }
        });

        elements.cancelDeleteImageBtn.addEventListener('click', () => {
            elements.deleteImageModal.classList.remove('show');
            imageToDelete = -1;
        });

        elements.confirmDeleteImageBtn.addEventListener('click', () => {
            if (imageToDelete !== -1 && imageToDelete < uploadedImages.length) {
                deleteImage(imageToDelete);
            }
            elements.deleteImageModal.classList.remove('show');
        });
    }

    // Handle file upload
    function handleFileUpload(e) {
        const files = e.target.files;
        handleFiles(files);
    }

    // Handle files (from upload or drag & drop)
    function handleFiles(files) {
        // Convert FileList to array
        const fileArray = Array.from(files);
        
        // Filter out non-image files and supported formats only
        const imageFiles = fileArray.filter(file => {
            return ['image/jpeg', 'image/png', 'image/webp'].includes(file.type);
        });
        
        if (imageFiles.length === 0) {
            alert('Please upload only JPG, PNG, or WebP images');
            return;
        }
        
        // Process each image file
        imageFiles.forEach(file => {
            processImageFile(file);
        });
        
        // Schedule batch compression update after all images uploaded
        setTimeout(() => {
            scheduleCompressionUpdate();
        }, 500);
    }

    // Process individual image file
    function processImageFile(file) {
        const reader = new FileReader();
        
        reader.onload = (e) => {
            const img = new Image();
            img.onload = async () => {
                // Calculate original image size in KB
                const originalSizeKB = (file.size / 1024).toFixed(2);
                
                // Create image object
                const image = {
                    file: file,
                    src: e.target.result,
                    name: file.name,
                    originalWidth: img.width,
                    originalHeight: img.height,
                    originalSize: file.size,
                    originalSizeKB: parseFloat(originalSizeKB),
                    compressedSize: 0,
                    compressedSizeKB: 0,
                    compressionRatio: 0
                };
                
                // Add to uploaded images array
                uploadedImages.push(image);
                
                // Render image in gallery first
                renderImage(image, uploadedImages.length - 1);
                
                // Update UI visibility
                updateUIVisibility();
            };
            
            img.src = e.target.result;
        };
        
        reader.readAsDataURL(file);
    }
    
    // Batch update compression results after all images uploaded
    let compressionUpdateTimeout = null;
    function scheduleCompressionUpdate() {
        if (compressionUpdateTimeout) {
            clearTimeout(compressionUpdateTimeout);
        }
        compressionUpdateTimeout = setTimeout(async () => {
            for (let i = 0; i < uploadedImages.length; i++) {
                await updateCompressionResults(uploadedImages[i], i);
            }
        }, 100);
    }
    
    // Update quality slider visibility based on compression mode
    function updateQualitySliderVisibility() {
        if (currentCompressionMode === 'lossy') {
            elements.qualityControl.style.display = 'block';
        } else {
            elements.qualityControl.style.display = 'none';
        }
    }

    // Perform lossless compression with multiple strategies
    function performLosslessCompression(image, outputFormat) {
        return new Promise((resolve) => {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                // Apply max dimension if specified
                let newWidth = img.width;
                let newHeight = img.height;
                const maxDimension = elements.maxDimensionSelect.value;
                
                if (maxDimension !== 'keep') {
                    const maxDim = parseInt(maxDimension);
                    if (img.width > maxDim || img.height > maxDim) {
                        const aspectRatio = img.width / img.height;
                        if (aspectRatio > 1) {
                            newWidth = maxDim;
                            newHeight = Math.round(maxDim / aspectRatio);
                        } else {
                            newHeight = maxDim;
                            newWidth = Math.round(maxDim * aspectRatio);
                        }
                    }
                }
                
                // Try multiple compression strategies
                const results = [];
                let completed = 0;
                const totalStrategies = 3;
                
                // Determine MIME type based on format
                const mimeType = outputFormat === 'png' ? 'image/png' : 
                               outputFormat === 'jpg' ? 'image/jpeg' : 'image/webp';
                
                // Strategy 1: Standard compression with quality 1.0
                const canvas1 = document.createElement('canvas');
                canvas1.width = newWidth;
                canvas1.height = newHeight;
                const ctx1 = canvas1.getContext('2d');
                ctx1.drawImage(img, 0, 0, newWidth, newHeight);
                canvas1.toBlob(function(blob) {
                    if (blob) {
                        results.push({ size: blob.size, quality: 1.0 });
                    }
                    completed++;
                    if (completed === totalStrategies) {
                        resolve(results);
                    }
                }, mimeType, 1.0);
                
                // Strategy 2: Try with slightly lower quality for better compression
                const canvas2 = document.createElement('canvas');
                canvas2.width = newWidth;
                canvas2.height = newHeight;
                const ctx2 = canvas2.getContext('2d');
                ctx2.drawImage(img, 0, 0, newWidth, newHeight);
                canvas2.toBlob(function(blob) {
                    if (blob) {
                        results.push({ size: blob.size, quality: 0.95 });
                    }
                    completed++;
                    if (completed === totalStrategies) {
                        resolve(results);
                    }
                }, mimeType, 0.95);
                
                // Strategy 3: Try with even lower quality for maximum compression
                const canvas3 = document.createElement('canvas');
                canvas3.width = newWidth;
                canvas3.height = newHeight;
                const ctx3 = canvas3.getContext('2d');
                ctx3.drawImage(img, 0, 0, newWidth, newHeight);
                canvas3.toBlob(function(blob) {
                    if (blob) {
                        results.push({ size: blob.size, quality: 0.9 });
                    }
                    completed++;
                    if (completed === totalStrategies) {
                        resolve(results);
                    }
                }, mimeType, 0.9);
            };
            
            img.onerror = function() {
                resolve([{ size: image.originalSize, quality: 1.0 }]);
            };
            
            img.src = image.src;
        });
    }

    // Calculate compression results for an image using actual canvas compression
    function calculateCompression(image) {
        return new Promise((resolve) => {
            const outputFormat = elements.outputFormatSelect.value;
            
            // Lossless compression logic optimization: multi-path exploration + only take optimal results
            if (currentCompressionMode === 'lossless') {
                // For JPG, also use multi-strategy compression
                if (outputFormat === 'jpg' || (outputFormat === 'keep' && image.file.type === 'image/jpeg')) {
                    performLosslessCompression(image, 'jpg').then(results => {
                        // Find the smallest file
                        const smallest = results.reduce((min, curr) => 
                            curr.size < min.size ? curr : min
                        );
                        resolve({
                            compressedSize: smallest.size,
                            compressedSizeKB: parseFloat((smallest.size / 1024).toFixed(2)),
                            compressionRatio: parseFloat(((1 - smallest.size / image.originalSize) * 100).toFixed(1))
                        });
                    });
                    return;
                } else {
                    // For PNG and WebP, perform lossless compression and compare sizes
                    performLosslessCompression(image, outputFormat).then(results => {
                        // Find the smallest file
                        const smallest = results.reduce((min, curr) => 
                            curr.size < min.size ? curr : min
                        );
                        resolve({
                            compressedSize: smallest.size,
                            compressedSizeKB: parseFloat((smallest.size / 1024).toFixed(2)),
                            compressionRatio: parseFloat(((1 - smallest.size / image.originalSize) * 100).toFixed(1))
                        });
                    });
                    return;
                }
            }
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                // Apply max dimension if specified
                let newWidth = img.width;
                let newHeight = img.height;
                const maxDimension = elements.maxDimensionSelect.value;
                
                if (maxDimension !== 'keep') {
                    const maxDim = parseInt(maxDimension);
                    if (img.width > maxDim || img.height > maxDim) {
                        const aspectRatio = img.width / img.height;
                        if (aspectRatio > 1) {
                            // Landscape image
                            newWidth = maxDim;
                            newHeight = Math.round(maxDim / aspectRatio);
                        } else {
                            // Portrait or square image
                            newHeight = maxDim;
                            newWidth = Math.round(maxDim * aspectRatio);
                        }
                    }
                }
                
                // Create canvas with new dimensions
                const canvas = document.createElement('canvas');
                canvas.width = newWidth;
                canvas.height = newHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                
                // Determine output format and quality
                let mimeType, quality;
                
                if (currentCompressionMode === 'lossless') {
                    // Quality settings in lossless mode
                    if (outputFormat === 'jpg' || (outputFormat === 'keep' && image.file.type === 'image/jpeg')) {
                        mimeType = 'image/jpeg';
                        quality = 0.9; // JPG lossless mode uses 90% quality
                    } else if (outputFormat === 'keep') {
                        mimeType = image.file.type;
                        quality = 1.0;
                    } else if (outputFormat === 'png') {
                        mimeType = 'image/png';
                        quality = 1.0;
                    } else if (outputFormat === 'webp') {
                        mimeType = 'image/webp';
                        quality = 1.0;
                    }
                } else {
                    // Quality setting in lossy mode - All formats use the slider's quality value
                    if (outputFormat === 'keep') {
                        mimeType = image.file.type;
                        quality = currentQuality / 100;
                    } else if (outputFormat === 'jpg') {
                        mimeType = 'image/jpeg';
                        quality = currentQuality / 100;
                    } else if (outputFormat === 'png') {
                        mimeType = 'image/png';
                        quality = currentQuality / 100;
                    } else if (outputFormat === 'webp') {
                        mimeType = 'image/webp';
                        quality = currentQuality / 100;
                    }
                }
                
                // Convert canvas to blob to get real file size
                canvas.toBlob(function(blob) {
                    if (blob) {
                        let compressedSize = blob.size;
                        
                        // PNG lossy compression: Use WebP as intermediate to achieve lossy effect
                        if ((outputFormat === 'png' || (outputFormat === 'keep' && image.file.type === 'image/png')) && currentCompressionMode === 'lossy') {
                            const quality = currentQuality / 100;
                            
                            // Convert to WebP (lossy compression)
                            canvas.toBlob(function(webpBlob) {
                                if (webpBlob) {
                                    const webpImg = new Image();
                                    webpImg.onload = function() {
                                        // Convert back to PNG
                                        const pngCanvas = document.createElement('canvas');
                                        pngCanvas.width = newWidth;
                                        pngCanvas.height = newHeight;
                                        const pngCtx = pngCanvas.getContext('2d');
                                        pngCtx.drawImage(webpImg, 0, 0, newWidth, newHeight);
                                        
                                        pngCanvas.toBlob(function(pngBlob) {
                                            if (pngBlob) {
                                                compressedSize = pngBlob.size;
                                            }
                                            
                                            const compressedSizeKB = parseFloat((compressedSize / 1024).toFixed(2));
                                            const compressionRatio = parseFloat(((1 - compressedSize / image.originalSize) * 100).toFixed(1));
                                            
                                            resolve({
                                                compressedSize: compressedSize,
                                                compressedSizeKB: compressedSizeKB,
                                                compressionRatio: compressionRatio
                                            });
                                        }, 'image/png');
                                    };
                                    webpImg.src = URL.createObjectURL(webpBlob);
                                }
                            }, 'image/webp', quality);
                            return;
                        }
                        
                        // PNG lossless compression optimization: try multiple strategies
                        if (currentCompressionMode === 'lossless' && outputFormat === 'png') {
                            // Strategy 1: try smaller compression level
                            const canvas2 = document.createElement('canvas');
                            canvas2.width = newWidth;
                            canvas2.height = newHeight;
                            const ctx2 = canvas2.getContext('2d');
                            ctx2.drawImage(img, 0, 0, newWidth, newHeight);
                            
                            // Use more aggressive PNG compression parameters
                            canvas2.toBlob(function(blob2) {
                                if (blob2 && blob2.size < compressedSize) {
                                    compressedSize = blob2.size;
                                }
                                
                                // Ensure lossless compression doesn't make file larger, except for JPG format
                                const isJPG = (outputFormat === 'jpg' || (outputFormat === 'keep' && image.file.type === 'image/jpeg'));
                                if (currentCompressionMode === 'lossless' && compressedSize > image.originalSize && !isJPG) {
                                    compressedSize = image.originalSize;
                                }
                                
                                const compressedSizeKB = parseFloat((compressedSize / 1024).toFixed(2));
                                const compressionRatio = parseFloat(((1 - compressedSize / image.originalSize) * 100).toFixed(1));
                                
                                resolve({
                                    compressedSize: compressedSize,
                                    compressedSizeKB: compressedSizeKB,
                                    compressionRatio: compressionRatio
                                });
                            }, 'image/png', 1.0);
                            return;
                        }
                        
                        // Ensure lossless compression doesn't make file larger, except for JPG format
                        const isJPG = (outputFormat === 'jpg' || (outputFormat === 'keep' && image.file.type === 'image/jpeg'));
                        if (currentCompressionMode === 'lossless' && compressedSize > image.originalSize && !isJPG) {
                            compressedSize = image.originalSize;
                        }
                        
                        const compressedSizeKB = parseFloat((compressedSize / 1024).toFixed(2));
                        const compressionRatio = parseFloat(((1 - compressedSize / image.originalSize) * 100).toFixed(1));
                        
                        resolve({
                            compressedSize: compressedSize,
                            compressedSizeKB: compressedSizeKB,
                            compressionRatio: compressionRatio
                        });
                    } else {
                        // Fallback to original size if blob creation fails
                        resolve({
                            compressedSize: image.originalSize,
                            compressedSizeKB: image.originalSizeKB,
                            compressionRatio: 0
                        });
                    }
                }, mimeType, quality);
            };
            
            img.onerror = function() {
                // Fallback if image fails to load
                resolve({
                    compressedSize: image.originalSize,
                    compressedSizeKB: image.originalSizeKB,
                    compressionRatio: 0
                });
            };
            
            img.src = image.src;
        });
    }

    // Update compression results for all images (async version)
    async function updateAllCompressionResults() {
        for (let i = 0; i < uploadedImages.length; i++) {
            await updateCompressionResults(uploadedImages[i], i);
        }
    }

    // Update compression results for a single image (async version)
    async function updateCompressionResults(image, index) {
        const results = await calculateCompression(image);
        
        // Update image object
        image.compressedSize = results.compressedSize;
        image.compressedSizeKB = results.compressedSizeKB;
        image.compressionRatio = results.compressionRatio;
        
        // Update UI if image is already rendered
        const imageElement = document.querySelector(`[data-image-index="${index}"]`);
        if (imageElement) {
            const compressedSizeElement = imageElement.querySelector('.compressed-size');
            const compressionInfoElement = imageElement.querySelector('.compression-info');
            
            if (compressedSizeElement) {
                compressedSizeElement.textContent = `${image.compressedSizeKB} KB`;
            }
            
            if (compressionInfoElement) {
                compressionInfoElement.textContent = `${image.compressionRatio}% lebih kecil`;
            }
        }
    }



    // Render image in gallery
    function renderImage(image, index) {
        const imageElement = document.createElement('div');
        imageElement.className = 'image-item';
        imageElement.setAttribute('data-image-index', index);
        
        imageElement.innerHTML = `
            <div class="image-preview-container">
                <img src="${image.src}" alt="${image.name}">
                <div class="image-actions">
                    <button class="image-action-btn info-btn" title="Lihat Info">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip">Info</span>
                    </button>
                    <button class="image-action-btn delete-img-btn" data-index="${index}" title="Hapus Gambar">
                        <i class="fas fa-trash"></i>
                        <span class="tooltip">Hapus</span>
                    </button>
                </div>
            </div>
            <div class="image-info">
                <div class="image-name">${image.name}</div>
                <div class="size-info">
                    <span class="original-size">${image.originalSizeKB} KB</span>
                    <span class="compressed-size">${image.compressedSizeKB} KB</span>
                </div>
                <div class="compression-info">${image.compressionRatio}% lebih kecil</div>
            </div>

        `;

        elements.imageContainer.appendChild(imageElement);
    }

    // Update UI visibility
    function updateUIVisibility() {
        if (uploadedImages.length > 0) {
            elements.uploadPrompt.style.display = 'none';
            elements.imageContainer.style.display = 'flex';
        } else {
            elements.uploadPrompt.style.display = 'flex';
            elements.imageContainer.style.display = 'none';
        }
    }

    // Delete single image
    function deleteImage(index) {
        if (index >= 0 && index < uploadedImages.length) {
            // Remove from array
            uploadedImages.splice(index, 1);
            
            // Remove from DOM
            elements.imageContainer.innerHTML = '';
            
            // Re-render remaining images with updated indices
            uploadedImages.forEach((image, newIndex) => {
                renderImage(image, newIndex);
            });
            
            // Update UI visibility
            updateUIVisibility();
            
            // If there are no more images, restore to the initial state
            if (uploadedImages.length === 0) {
                // Clear file input to allow re-uploading the same file
                elements.fileInput.value = '';
                
                // Reset all compression settings to initial state
                currentCompressionMode = 'lossy';
                currentQuality = 80;
                
                // Reset UI controls
                elements.lossyRadio.checked = true;
                elements.losslessRadio.checked = false;
                elements.qualitySlider.value = 80;
                elements.qualityDisplay.textContent = '80%';
                elements.maxDimensionSelect.value = 'keep';
                elements.outputFormatSelect.value = 'keep';
                
                // Update quality slider visibility
                updateQualitySliderVisibility();
                
                // Restore default SEO information
                document.title = 'Free Online Image Compressor | CaliperTools';
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) {
                    metaDesc.setAttribute('content', 'Compress images online free. Fast JPG, PNG, WebP compression. Reduce file size instantly. No upload needed. Best quality.');
                }
                const h1 = document.getElementById('tool-title');
                if (h1) {
                    h1.textContent = 'Image Compressor Online';
                }
                
                // When no images remain, completely restore to clean URL with .html suffix
                const newUrl = new URL(window.location.href);
                newUrl.search = '';
                
                const pathParts = newUrl.pathname.split('/');
                const compressorIndex = pathParts.findIndex(part => part === 'Image-Compression' || part === 'Image-Compression.html');
                
                if (compressorIndex !== -1) {
                    // Use Image-Compression.html with .html suffix explicitly
                    const basePath = pathParts.slice(0, compressorIndex).join('/');
                    newUrl.pathname = basePath + '/Image-Compression.html';
                }
                window.history.pushState({}, '', newUrl);
                
                // Manually reset output format to 'keep'
                const outputFormatSelect = document.getElementById('output-format');
                if (outputFormatSelect) {
                    outputFormatSelect.value = 'keep';
                }
            }
        }
    }

    // Process and download image with actual compression
    function processAndDownloadImage(image) {
        const outputFormat = elements.outputFormatSelect.value;
        
        // Special handling in lossless mode
        if (currentCompressionMode === 'lossless') {
            // Perform multi-strategy lossless compression for all formats
            const format = outputFormat === 'keep' ? 
                         (image.file.type === 'image/jpeg' ? 'jpg' : 
                          image.file.type === 'image/png' ? 'png' : 'webp') : 
                         outputFormat;
            
            performLosslessCompression(image, format).then(results => {
                // Temukan file terkecil
                const smallest = results.reduce((min, curr) => 
                    curr.size < min.size ? curr : min
                );
                
                // If the compressed file is larger than the original, download the original directly
                if (smallest.size > image.originalSize) {
                    const link = document.createElement('a');
                    link.href = image.src;
                    const extension = outputFormat === 'keep' ? image.name.split('.').pop() : outputFormat;
                    const baseName = image.name.substring(0, image.name.lastIndexOf('.'));
                    link.download = `compressed_${baseName}.${extension}`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    // Otherwise download compressed file
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = function() {
                        // Apply max dimension if specified
                        let newWidth = img.width;
                        let newHeight = img.height;
                        const maxDimension = elements.maxDimensionSelect.value;
                        
                        if (maxDimension !== 'keep') {
                            const maxDim = parseInt(maxDimension);
                            if (img.width > maxDim || img.height > maxDim) {
                                const aspectRatio = img.width / img.height;
                                if (aspectRatio > 1) {
                                    newWidth = maxDim;
                                    newHeight = Math.round(maxDim / aspectRatio);
                                } else {
                                    newHeight = maxDim;
                                    newWidth = Math.round(maxDim * aspectRatio);
                                }
                            }
                        }
                        
                        const canvas = document.createElement('canvas');
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);
                        
                        const mimeType = format === 'png' ? 'image/png' : 
                                       format === 'jpg' ? 'image/jpeg' : 'image/webp';
                        
                        const dataUrl = canvas.toDataURL(mimeType, smallest.quality);
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        const extension = outputFormat === 'keep' ? image.name.split('.').pop() : outputFormat;
                        const baseName = image.name.substring(0, image.name.lastIndexOf('.'));
                        link.download = `compressed_${baseName}.${extension}`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    };
                    img.src = image.src;
                }
            });
            return;
        }
        
        // Normal processing in lossy mode
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function() {
            // Apply max dimension if specified
            let newWidth = img.width;
            let newHeight = img.height;
            const maxDimension = elements.maxDimensionSelect.value;
            
            if (maxDimension !== 'keep') {
                const maxDim = parseInt(maxDimension);
                if (img.width > maxDim || img.height > maxDim) {
                    const aspectRatio = img.width / img.height;
                    if (aspectRatio > 1) {
                        // Landscape image
                        newWidth = maxDim;
                        newHeight = Math.round(maxDim / aspectRatio);
                    } else {
                        // Portrait or square image
                        newHeight = maxDim;
                        newWidth = Math.round(maxDim * aspectRatio);
                    }
                }
            }
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions with max dimension applied
            canvas.width = newWidth;
            canvas.height = newHeight;
            
            // Draw the image with resizing
            ctx.drawImage(img, 0, 0, newWidth, newHeight);
            
            // Determine output format and quality
            let mimeType, quality;
            
            if (outputFormat === 'keep') {
                // Use original format if "Keep original" is selected
                const originalFormat = image.file.type;
                mimeType = originalFormat;
                quality = currentQuality / 100;
            } else if (outputFormat === 'jpg') {
                mimeType = 'image/jpeg';
                quality = currentQuality / 100;
            } else if (outputFormat === 'png') {
                mimeType = 'image/png';
                quality = currentQuality / 100;
            } else if (outputFormat === 'webp') {
                mimeType = 'image/webp';
                quality = currentQuality / 100;
            }
            
            // Convert canvas to data URL with compression
            const dataUrl = canvas.toDataURL(mimeType, quality);
            
            // Create download link
            const link = document.createElement('a');
            link.href = dataUrl;
            
            // Set appropriate filename
            const originalName = image.name;
            const baseName = originalName.substring(0, originalName.lastIndexOf('.'));
            const extension = outputFormat === 'keep' ? originalName.split('.').pop() : outputFormat;
            link.download = `compressed_${baseName}.${extension}`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
        
        img.src = image.src;
    }

    // Create ZIP archive with compressed images
    function createZipArchive() {
        if (uploadedImages.length === 0) {
            alert('Tidak ada gambar untuk diunduh');
            return;
        }
        
        const zip = new JSZip();
        let processedCount = 0;
        const outputFormat = elements.outputFormatSelect.value;
        
        uploadedImages.forEach(image => {
            // Remove special handling for JPG in lossless mode using original, change to using 90% quality
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                // Apply max dimension if specified
                let newWidth = img.width;
                let newHeight = img.height;
                const maxDimension = elements.maxDimensionSelect.value;
                
                if (maxDimension !== 'keep') {
                    const maxDim = parseInt(maxDimension);
                    if (img.width > maxDim || img.height > maxDim) {
                        const aspectRatio = img.width / img.height;
                        if (aspectRatio > 1) {
                            // Landscape image
                            newWidth = maxDim;
                            newHeight = Math.round(maxDim / aspectRatio);
                        } else {
                            // Portrait or square image
                            newHeight = maxDim;
                            newWidth = Math.round(maxDim * aspectRatio);
                        }
                    }
                }
                
                const canvas = document.createElement('canvas');
                canvas.width = newWidth;
                canvas.height = newHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                
                // Determine output format and quality
                let mimeType, quality;
                
                if (currentCompressionMode === 'lossless') {
                    // Quality setting in lossless mode - Multi-strategy compression for all formats
                    const format = outputFormat === 'keep' ? 
                                 (image.file.type === 'image/jpeg' ? 'jpg' : 
                                  image.file.type === 'image/png' ? 'png' : 'webp') : 
                                 outputFormat;
                    
                    // Perform multi-strategy compression for all formats
                    performLosslessCompression(image, format).then(results => {
                        // Find the smallest file
                        const smallest = results.reduce((min, curr) => 
                            curr.size < min.size ? curr : min
                        );
                        
                        const mimeType = format === 'png' ? 'image/png' : 
                                       format === 'jpg' ? 'image/jpeg' : 'image/webp';
                        
                        // Regenerate blob with optimal quality parameters
                        const canvas = document.createElement('canvas');
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);
                        
                        canvas.toBlob(function(blob) {
                            if (blob) {
                                const isJPG = (format === 'jpg');
                                // For JPG format, always use compressed file even if larger than original
                                if (isJPG || blob.size <= image.originalSize) {
                                    const originalName = image.name;
                                    const baseName = originalName.substring(0, originalName.lastIndexOf('.'));
                                    const extension = outputFormat === 'keep' ? originalName.split('.').pop() : outputFormat;
                                    const filename = `compressed_${baseName}.${extension}`;
                                    
                                    // Add blob to zip
                                    zip.file(filename, blob);
                                    
                                    processedCount++;
                                } else {
                                    // For other formats, if compressed file is larger than original, use original directly
                                    fetch(image.src)
                                        .then(response => response.blob())
                                        .then(originalBlob => {
                                            const originalName = image.name;
                                            zip.file(originalName, originalBlob);
                                            
                                            processedCount++;
                                        });
                                    return;
                                }
                                
                                // If all images are processed, generate and download the zip
                                if (processedCount === uploadedImages.length) {
                                    zip.generateAsync({ type: 'blob' }).then(function(content) {
                                        const link = document.createElement('a');
                                        link.href = URL.createObjectURL(content);
                                        link.download = 'compressed_images.zip';
                                        document.body.appendChild(link);
                                        link.click();
                                        document.body.removeChild(link);
                                        URL.revokeObjectURL(link.href);
                                    });
                                }
                            } else {
                                // If blob creation fails, use original image
                                fetch(image.src)
                                    .then(response => response.blob())
                                    .then(originalBlob => {
                                        const originalName = image.name;
                                        zip.file(originalName, originalBlob);
                                        
                                        processedCount++;
                                        
                                        // If all images are processed, generate and download the zip
                                        if (processedCount === uploadedImages.length) {
                                            zip.generateAsync({ type: 'blob' }).then(function(content) {
                                                const link = document.createElement('a');
                                                link.href = URL.createObjectURL(content);
                                                link.download = 'compressed_images.zip';
                                                document.body.appendChild(link);
                                                link.click();
                                                document.body.removeChild(link);
                                                URL.revokeObjectURL(link.href);
                                            });
                                        }
                                    });
                            }
                        }, mimeType, smallest.quality);
                    });
                    return;
                } else {
                    // Quality setting in lossy mode - All formats use the slider's quality value
                    if (outputFormat === 'keep') {
                        const originalFormat = image.file.type;
                        mimeType = originalFormat;
                        quality = currentQuality / 100;
                    } else if (outputFormat === 'jpg') {
                        mimeType = 'image/jpeg';
                        quality = currentQuality / 100;
                    } else if (outputFormat === 'png') {
                        mimeType = 'image/png';
                        quality = currentQuality / 100;
                    } else if (outputFormat === 'webp') {
                        mimeType = 'image/webp';
                        quality = currentQuality / 100;
                    }
                }
                
                // Convert canvas to blob with compression
                canvas.toBlob(function(blob) {
                    if (blob) {
                        const isJPG = (outputFormat === 'jpg' || (outputFormat === 'keep' && image.file.type === 'image/jpeg'));
                        // For JPG format, always use the compressed file, even if it is larger than the original
                        if (isJPG || blob.size <= image.originalSize) {
                            const originalName = image.name;
                            const baseName = originalName.substring(0, originalName.lastIndexOf('.'));
                            const extension = outputFormat === 'keep' ? originalName.split('.').pop() : outputFormat;
                            const filename = `compressed_${baseName}.${extension}`;
                            
                            // Add blob to zip
                            zip.file(filename, blob);
                            
                            processedCount++;
                        } else {
                            // For other formats, if compressed file is larger than original, use original directly
                            fetch(image.src)
                                .then(response => response.blob())
                                .then(originalBlob => {
                                    const originalName = image.name;
                                    zip.file(originalName, originalBlob);
                                    
                                    processedCount++;
                                });
                            return;
                        }
                        
                        // If all images are processed, generate and download the zip
                        if (processedCount === uploadedImages.length) {
                            zip.generateAsync({ type: 'blob' }).then(function(content) {
                                const link = document.createElement('a');
                                link.href = URL.createObjectURL(content);
                                link.download = 'compressed_images.zip';
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                URL.revokeObjectURL(link.href);
                            });
                        }
                    } else {
                        // If blob creation fails, use original image
                        fetch(image.src)
                            .then(response => response.blob())
                            .then(originalBlob => {
                                const originalName = image.name;
                                zip.file(originalName, originalBlob);
                                
                                processedCount++;
                                
                                // If all images are processed, generate and download the zip
                                if (processedCount === uploadedImages.length) {
                                    zip.generateAsync({ type: 'blob' }).then(function(content) {
                                        const link = document.createElement('a');
                                        link.href = URL.createObjectURL(content);
                                        link.download = 'compressed_images.zip';
                                        document.body.appendChild(link);
                                        link.click();
                                        document.body.removeChild(link);
                                        URL.revokeObjectURL(link.href);
                                    });
                                }
                            });
                    }
                }, mimeType, quality);
            };
            
            img.src = image.src;
        });
    }

    // Initialize the application
    init();
});
    </script>
</body>
</html>